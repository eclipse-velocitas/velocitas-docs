<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.98.0" />
<link rel="canonical" type="text/html" href="/velocitas/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="/velocitas/docs/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/velocitas/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/velocitas/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/velocitas/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/velocitas/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/velocitas/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/velocitas/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/velocitas/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/velocitas/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/velocitas/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/velocitas/favicons/android-192x192.png" sizes="192x192">

<title>Documentation | Velocitas</title>
<meta name="description" content="">
<meta property="og:title" content="Documentation" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/velocitas/docs/" />

<meta itemprop="name" content="Documentation">
<meta itemprop="description" content=""><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Documentation"/>
<meta name="twitter:description" content=""/>




<link rel="preload" href="/velocitas/scss/main.min.1d182b71ccb4ba22c0df507b864c03da3407c2b853f78311ec5508811eeb3467.css" as="style">
<link href="/velocitas/scss/main.min.1d182b71ccb4ba22c0df507b864c03da3407c2b853f78311ec5508811eeb3467.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-130444728-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/velocitas/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="font-weight-bold">Velocitas</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/velocitas/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/eclipse-velocitas" target="_blank" ><span>GitHub</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/velocitas/offline-search-index.9a3269c1e99a8697c25ae9dc0eb80d97.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/velocitas/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Documentation</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-fcf6186c3c17ed7f2e8577136109a520">Concepts</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-5a04118b2f2cb48ee8f919d2ada510cc">Development Model</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.2: <a href="#pg-1c1f612770264fbdf84b59f9adcafa3a">Python Vehicle App SDK</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.3: <a href="#pg-b22e3deec09013424a1cf54e716bd28f">Runtime and Deployment Model</a></li>


    
  
    
    
	
<li>1.4: <a href="#pg-da1f21767304bce723a2d04d2f5058f7">Build and Release Process</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-8dbd4e302cd86a4d0f71f71ce3b300de">Tutorials</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-836220d69d36433f11749c9a6b5b96eb">Quickstart</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-3999eec4307d02364111550f29f4ea06">Python Vehicle Model Creation</a></li>


    
  
    
    
	
<li>2.3: <a href="#pg-2b30ec67b931796925324af48e8e2f00">Python Vehicle App Development</a></li>


    
  
    
    
	
<li>2.4: <a href="#pg-9d91984eb08cf20e39f25e171f5fb593">Run Vehicle App Runtime Services</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.4.1: <a href="#pg-b8a7e76bb8b53cf7ffc3a8f82f85ba4c">Run runtime services in Kubernetes</a></li>


    
  
    
    
	
<li>2.4.2: <a href="#pg-c17c8d2574e5368e139743922d9a9fc3">Run runtime services locally</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2.5: <a href="#pg-92434ff59ee018c09ee5056e41a30ded">Vehicle App Integration Testing</a></li>


    
  
    
    
	
<li>2.6: <a href="#pg-f3e319d0b9b198af5c39068a78e57d4b">Vehicle App Deployment with Helm</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-8df6ea6904416b571ff9bc73afb50933">Reference</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-3ff87169322881c55b35cb588a8807ea">Vehicle Abstraction Layer (VAL)</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1.1: <a href="#pg-9a5bb1344781821cfb0c525d922e645e">Interface Design Guideline</a></li>


    
  
    
    
	
<li>3.1.2: <a href="#pg-f1136af6ab1b33398c08627b35700094">Vehicle Service</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.2: <a href="#pg-2dbd1b20fb31fad11d756d7570dfb78a">Example Use Case</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3.3: <a href="#pg-8a3bf83ce793563bed50c1b9fb0ecfae">Repository Overview</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-8eac61776bcf71227e63036ad316802b">Contribution</a></li>


    
  

    </ul>


<div class="content">
      <h2 id="background">Background</h2>
<p>Traditionally, the automotive industry was and still is centered around vehicle hardware and the corresponding hardware development and life-cycle management. Software, however, is gaining more and more importance in vehicle development and over the entire vehicle lifetime. Thus, the vehicle and its value to the customer is increasingly defined by software. This transition towards what are termed as software-defined vehicles changes the way in which we innovate, code, deliver and work together. It is a change across the whole mobility value chain and life-cycle: from development and production to delivery and operations of the vehicle.</p>
<h2 id="goal">Goal</h2>
<p>The Eclipse project <em>Velocitas</em> aims to build-up an end-to-end, scalable and modular development toolchain to create containerized in-vehicle applications (<em>Vehicle Apps</em>) that offers a comfortable, fast and efficient development experience to increase the speed of a development team.</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/dev_ops_cycle_hud6b43f52ee34e3c29c23ce273a74f400_61217_800x0_resize_catmullrom_3.png" width="800" height="217">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  The DevOps cycle that it followed in the design of the Velocitas programnming model
</p>
	</figcaption>
	
</figure>

<table>
<thead>
<tr>
<th>Category</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/eclipse-velocitas/vehicle-app-python-template">Vehicle App Project Template</a></td>
<td>Quick setup of a <em>Vehicle App</em> project with the help of GitHub templates for the supported programming languages including a sample <em>Vehicle App</em> and GitHub Actions workflow, and comfortable setup of the development environment e.g. in Microsoft Visual Studio Code.</td>
</tr>
<tr>
<td><a href="/docs/development-model.md">Vehicle App Programming Model</a></td>
<td>Simplify coding and debugging of <em>Vehicle Apps</em> that accessing vehicle data points and modifying vehicle functions using the provided SDK for the different programming languages that delegates to the <em>Vehicle Abstraction Layer</em>.</td>
</tr>
<tr>
<td><a href="docs/val/README.md">Vehicle Abstraction Layer</a></td>
<td>Abstracts vehicle make &amp; model specific properties and capabilities to a common representation. This makes it possible for <em>Vehicle Apps</em> to be portable across different electric and electronic vehicle architectures e.g. the <em>Vehicle Apps</em> do not care whether the seat is controlled via CAN, LIN or some other physical interface.</td>
</tr>
<tr>
<td><a href="/docs/concepts/vehicle_app_releases/#ci-workflow-ciyml">GitHub Actions Workflow Blueprint</a></td>
<td>Providing ready-to-use GitHub workflows to check the <em>Vehicle App</em>, build images for multi architectures, scan it, execute integration tests and release the <em>Vehicle App</em> to allow the developer to focus on the development of the <em>Vehicle App</em>.</td>
</tr>
<tr>
<td><a href="/docs/concepts/vehicle_app_releases/#release-workflow-releaseyml">Automated Release Process</a></td>
<td>Providing a release workflow to generate release artifacts and documentation out of the CI workflow results and push it to a container registry to be used by a deployment system</td>
</tr>
<tr>
<td><a href="docs/runtime-deployment-model.md">Runtime and Deployment Model</a></td>
<td>Running and deploying <em>Vehicle App</em> as OCI-compliant container to increase the flexibility to support different programming languages and runtimes to accelerate innovation and development.</td>
</tr>
</tbody>
</table>
<p>The repositories of the Eclipse project <em>Velocitas</em> and their relations between each other can be found [<a href="docs/repository_overview.md">here</a>].</p>
<h2 id="example-use-case">Example Use Case</h2>
<p><em>Velocitas</em> contains implementations based on the example use case of adjusting the vehicle seat position to showcase the development toolchain of a comfort function (QM level - non-safety relevant).</p>
<p>What could such a use case look like? Image a carsharing company that wants to offer its customers the functionality that the driver seat automatically moves to the right position, when the driver enters the rented car. The carsharing company knows the driver and has stored the preferred seat position of the driver in its driver profile. The car gets unlocked by the driver and a request for the preferred seat position of the driver will be sent to the vehicle.</p>
<p>That&rsquo;s where your implementation starts. The <em>Seat Adjuster VehicleApp</em> receives the seat position as a MQTT message and triggers a seat adjustment command of the <em>Seat Service</em> that changes the seat position. Of course, the driver of a rented car would like the position, that he may have set himself, to be saved by the carsharing company and used for the next trip. As a result, the <em>Seat Adjuster VehicleApp</em> subscribes to the seat position and receives the new seat position from the <em>Vehicle Data Broker</em> that streams the data from the <em>Seat Service</em>.</p>
<p>A detailed description of the <em>Seat Adjuster</em> use case can be found <a href="docs/seat_adjuster_use_case.md">here</a>.</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/seat_adjuster_dataflow_huc9879869dc6f6fe04b6952a240f799e3_220968_800x0_resize_catmullrom_3.png" width="800" height="477">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Architectural representation of the data flow on the example of adjusting the seat position     
</p>
	</figcaption>
	
</figure>

<h2 id="quickstart-tutorials">Quickstart tutorials</h2>
<ol>
<li><a href="/docs/setup_and_explore_development_environment.md">Setup and Explore Development Enviroment</a></li>
<li><a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_model.md">Developing a Vehicle Model in Python</a></li>
<li><a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_app.md">Developing a Vehicle App in Python</a></li>
<li><a href="/docs/integration_tests.md">Run and develop integration tests for Vehicle Apps</a></li>
</ol>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/COVESA/vehicle_signal_specification">Vehicle Signal Specifications (VSS)</a></li>
</ul>
<h2 id="community">Community</h2>
<ul>
<li><a href="">GitHub Issues</a></li>
<li><a href="https://accounts.eclipse.org/mailing-list/velocitas-dev">Mailing List</a></li>
<li><a href="/velocitas/docs/contributing/contribution">Contribution</a></li>
</ul>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fcf6186c3c17ed7f2e8577136109a520">1 - Concepts</h1>
    <div class="lead">Explore the basic concepts of Eclipse Velocity™.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-5a04118b2f2cb48ee8f919d2ada510cc">1.1 - Development Model</h1>
    <div class="lead">Learn more about provided development model for Vehicle Apps.</div>
	<h2 id="introduction">Introduction</h2>
<p>The Velocitas development model is centered around what are known as <a href="#vehicle-apps">Vehicle Apps</a>. Automation allows engineers to make high-impact changes frequently and deploy <a href="#vehicle-apps">Vehicle Apps</a> through cloud backends as over-the-air updates. The <a href="#vehicle-apps">Vehicle App</a> development model is about <em>speed</em> and <em>agility</em> paired with state-of-the-art software quality.</p>
<h2 id="development-architecture">Development Architecture</h2>
<p>Velocitas provides a flexible development architecture for <a href="#vehicle-apps">Vehicle Apps</a>. The following diagram shows the major components of the Velocitas stack.</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/concepts/development_model/programming_model_hud2fec3852a7bf670c5b8a8b5db354a69_89799_800x0_resize_catmullrom_3.png" width="800" height="674">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Overview of the progamming model
</p>
	</figcaption>
	
</figure>

<h3 id="vehicle-apps">Vehicle Apps</h3>
<p>The Vehicle Applications (aka. <code>Vehicle Apps</code>) contain the business logic that needs to be executed on a vehicle. A Vehicle App is implemented on top of a <a href="#vehicle-models">Vehicle Model</a> and its underlying language-specific <a href="#sdks">SDK</a>. Many concepts of cloud-native and <a href="https://12factor.net/">twelve-factor</a> applications apply to <code>Vehicle Apps</code> as well and are summarized in the next chapter.</p>
<h3 id="vehicle-models">Vehicle Models</h3>
<p>A Vehicle Model makes it possible to easily get vehicle data from the <a href="#vehicle-data-broker">Vehicle Data Broker</a> and to execute remote procedure calls over gRPC against <a href="#vehicle-services">Vehicle Services</a> and other <a href="#vehicle-apps">Vehicle Apps</a>. It is generated from the underlying <a href="#semantic-models">semantic models</a> for a concrete programming language as a graph-based, strongly-typed, intellisense-enabled library. The elements of the vehicle models are defined in the <a href="#sdks">SDKs</a>.</p>
<h3 id="sdks">SDKs</h3>
<p>To reduce the effort required to implement <a href="#vehicle-apps">Vehicle Apps</a>, Velocitas provides a set of SDKs for different programming languages. A first SDK is available for Python, further SDKs for Rust and C/C++ are planned.
Next to a <a href="#vehicle-apps">Vehicle Apps</a> abstraction, the SDKs are <a href="#middleware">Middleware</a>-enabled, provide connectivity to the <a href="#vehicle-data-broker">Vehicle Data Broker</a> and contain the ontology in the form of base classes to create <a href="#vehicle-models">Vehicle Models</a>.</p>
<h3 id="vehicle-services">Vehicle Services</h3>
<p><code>Vehicle Services</code> provide service interfaces to control actuators or to trigger (complex) actions. E.g. they communicate with the vehicle internals networks like CAN or Ethernet, which are connected to actuators, electronic control units (ECUs) and other vehicle computers (VCs). They may provide a simulation mode to run without a network interface. <code>Vehicle services</code> may feed data to the <a href="#vehicle-data-broker">Vehicle Data Broker</a> and may expose gRPC endpoints, which can be invoked by <a href="#vehicle-apps">Vehicle Apps</a> over a <a href="#vehicle-models">Vehicle Model</a></p>
<h3 id="vehicle-data-broker">Vehicle Data Broker</h3>
<p>Vehicle data is stored in the <code>Vehicle Data Broker</code> conforming to an underlying <a href="#semantic-models">Semantic Model</a> like VSS. <a href="#vehicle-apps">Vehicle Apps</a> can either pull this data or subscribe for updates. In addition, it supports rule-based access to reduce the number of updates sent. The storage of the vehicle data broker will be the vehicle twin that syncs its data to the cloud.</p>
<h3 id="semantic-models">Semantic models</h3>
<p>The Vehicle Signal Specification (<a href="https://covesa.github.io/vehicle_signal_specification/">VSS</a>) provides a domain taxonomy for vehicle signals and defines the vehicle data semantically, which is exchanged between <code>Vehicle Apps</code> and the <code>vehicle data broker</code>.</p>
<p>The Vehicle Service Catalog (<a href="https://github.com/COVESA/vehicle_service_catalog#vehicle-service-catalog">VSC</a>) extends VSS with functional remote procedure call definitions and semantically defines the gRPC interfaces of <code>Vehicle Services</code> and <code>Vehicle Apps</code>.</p>
<p>As an alternative to VSS and VSC, vehicle data and services can be defined semantically in a general IoT modelling language like Digital Twin Definition Language (<a href="https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md">DTDL</a>) or BAMM Aspect Meta Model <a href="https://github.com/OpenManufacturingPlatform/sds-bamm-aspect-meta-model">BAMM</a> as well.</p>
<h3 id="communication-protocols">Communication Protocols</h3>
<p>Asynchronous communication between <a href="#vehicle-apps">Vehicle Apps</a> and other vehicle components as well as cloud connectivity is facilitated through <a href="https://mqtt.org/">MQTT</a> messaging. Direct, synchronous communication between <a href="#vehicle-apps">Vehicle Apps</a>, <a href="#vehicle-services">Vehicle Services</a> and the <a href="#vehicle-data-broker">Vehicle Data Broker</a> is based on the <a href="https://grpc.io/">gRPC</a> protocol.</p>
<h3 id="middleware">Middleware</h3>
<p>Velocitas leverages <a href="https://dapr.io">dapr</a> for gRPC service discovery, Open Telemetry tracing and the <a href="https://docs.dapr.io/developing-applications/building-blocks/pubsub/pubsub-overview/">publish/subscribe building block</a> as a higher-level abstraction over MQTT messaging.</p>
<h3 id="vehicle-edge-operating-system">Vehicle Edge Operating System</h3>
<p><a href="#vehicle-apps">Vehicle Apps</a> are expected to run on a <a href="https://www.linux.org/">Linux</a>-based operating system. An OCI-compliant container runtime is required to host the Vehicle App containers and the dapr middleware mandates a Kubernetes control plane. For publish/subscribe messaging a MQTT broker must be available (e.g., <a href="https://mosquitto.org/">Eclipse Mosquitto</a>).</p>
<h2 id="vehicle-app-characteristics">Vehicle App characteristics</h2>
<h3 id="code-base">Code Base</h3>
<p>Every <a href="#vehicle-apps">Vehicle App</a> is stored in its own repository. Tracked with version control, it can be deployed to multiple environments.</p>
<h3 id="polyglot">Polyglot</h3>
<p><a href="#vehicle-apps">Vehicle Apps</a> can be written in any programming language. System-level programming languages like Rust and C/C++ are particularly relevant for limited hardware resources found in vehicles, but higher-level languages like Python and JavaScript are also considered for special use cases.</p>
<h3 id="oci-compliant-containers">OCI-compliant containers</h3>
<p><a href="#vehicle-apps">Vehicle Apps</a> are deployed as OCI-compliant containers. The size of these containers should be minimal to fit on constrained devices.</p>
<h3 id="isolation">Isolation</h3>
<p>Each <a href="#vehicle-apps">Vehicle App</a> should execute in its own process and should be self-contained with its interfaces and functionality exposed on its own port.</p>
<h3 id="configurations">Configurations</h3>
<p>Configuration information is moved out of the <a href="#vehicle-apps">Vehicle App</a>, so that the same deployment can propagate across environments with the correct configuration applied.</p>
<h3 id="disposability">Disposability</h3>
<p>Favor fast startup and support graceful shutdowns to leave the system in a correct state.</p>
<h3 id="observability">Observability</h3>
<p><a href="#vehicle-apps">Vehicle Apps</a> provide traces, metrics and logs of every part of the application using <em>Open Telemetry</em>.</p>
<h3 id="over-the-air-updatability">Over-the-air updatability</h3>
<p><a href="#vehicle-apps">Vehicle Apps</a> are released to cloud backends like the <a href="https://www.bosch-mobility-solutions.com/en/solutions/software-and-services/mobility-cloud/">Bosch Mobility Cloud</a> and can be updated in vehicles frequently over the air.</p>
<h2 id="development-process">Development Process</h2>
<p>The starting point for developing <a href="#vehicle-apps">Vehicle Apps</a> is a <a href="#semantic-models">Semantic Model</a> of the vehicle data and vehicle services. Based on the <a href="#semantic-models">Semantic Model</a>, language-specific <a href="#vehicle-models">Vehicle Models</a> are generated. <a href="#vehicle-models">Vehicle Models</a> are then distributed as packages to the respective package manager of the chosen programming language (e.g. pip, cargo, npm, &hellip;).</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/concepts/development_model/build_procedure_hu5f49376adac41f286048be697899cf00_25062_800x0_resize_catmullrom_3.png" width="800" height="299">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Architectural diagram of the build process
</p>
	</figcaption>
	
</figure>

<p>After a <a href="#vehicle-models">Vehicle Model</a> is available for the chosen programming language, the <a href="#vehicle-apps">Vehicle App</a> can be developed using the generated Vehicle Model and its core SDK.</p>
<h2 id="next-steps">Next steps</h2>
<h3 id="vehicle-apps-sdk-documentation">Vehicle Apps SDK Documentation</h3>
<ul>
<li><a href="/python-sdk/python_vehicle_app_sdk_overview.md">Python SDK Overview</a></li>
<li>Coming soon: Rust SDK Overview</li>
</ul>
<h3 id="working-with-vehicle-models">Working with Vehicle Models</h3>
<ul>
<li>Walkthrough: <a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_model.md">Creating a Python Vehicle Model</a></li>
<li>Coming soon: Creating a Rust Vehicle Model</li>
</ul>
<h3 id="working-with-vehicle-apps">Working with Vehicle Apps</h3>
<ul>
<li>Walkthrough: <a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_app.md">Creating a Python Vehicle App</a></li>
<li>Coming soon: Creating a Rust Vehicle App</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1c1f612770264fbdf84b59f9adcafa3a">1.2 - Python Vehicle App SDK</h1>
    <div class="lead">Learn more about the provided Python Vehicle App SDK.</div>
	<h2 id="introduction">Introduction</h2>
<p>The Python Vehicle App SDK consists of the following building blocks:</p>
<ul>
<li>
<p><strong><a href="#vehicle-model-ontology">Vehicle Model Ontology</a></strong>: The SDK provides a set of model base classes for the creation of vehicle models.</p>
</li>
<li>
<p><strong><a href="#middleware-integration">Middleware integration</a></strong>: Vehicle Models can contain gRPC stubs to communicate with Vehicle Services. gRPC communication is integrated with the <a href="https://dapr.io">Dapr</a> middleware for service discovery and <a href="https://opentelemetry.io">OpenTelemetry</a> tracing.</p>
</li>
<li>
<p><strong><a href="#Fluent-query--rule-construction">Fluent query &amp; rule construction</a></strong>: Based on a concrete Vehicle Model, the SDK is able to generate queries and rules against the Vehicle Data Broker to access the real values of the data points that are defined in the vehicle model.</p>
</li>
<li>
<p><strong><a href="#publish--subscribe-messaging">Publish &amp; subscribe messaging</a></strong>: The SDK supports publishing messages to a MQTT broker and subscribing to topics of a MQTT broker.</p>
</li>
<li>
<p><strong><a href="#Vehicle-App-abstraction">Vehicle App abstraction</a></strong>: Last but not least the SDK provides a Vehicle App base class, which every Vehicle App derives from.</p>
</li>
</ul>
<p>An overview of the Vehicle App SDK for Python and its dependencies is depicted in the following diagram:</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/concepts/python_vehicle_app_sdk/pyhon_sdk_overview_hu7485307a3843777bc51a573bc09fadda_86244_800x0_resize_catmullrom_3.png" width="800" height="565">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Overview of Python SDK architecture
</p>
	</figcaption>
	
</figure>

<h2 id="vehicle-model-ontology">Vehicle Model Ontology</h2>
<p>The Vehicle Model is a tree-based model where every branch in the tree, including the root, is derived from the Model base class.</p>
<p>The Vehicle Model Ontology consists of the following classes:</p>
<h3 id="model">Model</h3>
<p>A model contains services, data points and other models. It corresponds to branch entries in VSS or interfaces in DTDL or namespaces in VSC.</p>
<h3 id="modelcollection">ModelCollection</h3>
<p>Specifications like VSS support a concept that is called <a href="https://covesa.github.io/vehicle_signal_specification/rule_set/instances/">Instances</a>. It makes it possible to describe repeating definitions. In DTDL, such kind of structures may be modeled with <a href="https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md#relationship">Relationships</a>. In the SDK, these structures are mapped with the <code>ModelCollection</code> class. A <code>ModelCollection</code> is a collection of models, which make it possible to reference an individual model either by a <code>NamedRange</code> (e.g., Row [1-3]), a <code>Dictionary</code> (e.g., &ldquo;Left&rdquo;, &ldquo;Right&rdquo;) or a combination of both.</p>
<h3 id="service">Service</h3>
<p>Direct synchronous communication between Vehicle Apps and Vehicle Services is supposed to be facilitated over the <a href="https://grpc.io">gRPC</a> protocol.</p>
<p>The SDK has its own <code>Service</code> base class, which provides a convenience API layer to access the exposed methods of exactly one gRPC endpoint of a Vehicle Service or another Vehicle App. Please see the <a href="#middleware-integration">Middleware Integration</a> section for more details.</p>
<h3 id="datapoint">DataPoint</h3>
<p><code>DataPoint</code> is the base class for all data points. It corresponds to sensors/actuators in VSS or telemetry / properties in DTDL.</p>
<p>Data Points are the signals that are typically emitted by Vehicle Services.</p>
<p>The representation of a data point is a path starting with the root model, e.g.:</p>
<ul>
<li><code>Vehicle.Speed</code></li>
<li><code>Vehicle.FuelLevel</code></li>
<li><code>Vehicle.Cabin.Seat.Row1.Pos1.Position</code></li>
</ul>
<p>Data points are defined as attributes of the model classes. The attribute name is the name of the data point without its path.</p>
<h3 id="typed-datapoint-classes">Typed DataPoint classes</h3>
<p>Every primitive datatype has a corresponding typed data point class, which is derived from <code>DataPoint</code> (e.g., <code>DataPointInt32</code>, <code>DataPointFloat</code>, <code>DataPointBool</code>, <code>DataPointString</code>, etc.).</p>
<h3 id="example">Example</h3>
<p>An example of a Vehicle Model created with the described ontology is shown below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a40000">```</span><span style="color:#000">Python</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># import ontology classes</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">DataPointDouble</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Model</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Service</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">DataPointInt32</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">DataPointBool</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">DataPointArray</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">DataPointString</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ModelCollection</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">NamedRange</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">parent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">parent</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Position</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointBool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Position&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">IsOccupied</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointBool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;IsOccupied&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">IsBelted</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointBool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;IsBelted&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Height</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointInt32</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Height&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Recline</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointInt32</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Recline&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Cabin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">parent</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">parent</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DriverPosition</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointInt32</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;DriverPosition&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Seat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ModelCollection</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">](</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">[</span><span style="color:#000">NamedRange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Row&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">NamedRange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Pos&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)],</span> <span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">VehicleIdentification</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">parent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">parent</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">VIN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;VIN&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Model&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">CurrentLocation</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">parent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">parent</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Latitude</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointDouble</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Latitude&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Longitude</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointDouble</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Longitude&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Timestamp</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Timestamp&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Altitude</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointDouble</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Altitude&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Vehicle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Speed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointFloat</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Speed&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CurrentLocation</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CurrentLocation</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Cabin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Cabin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">vehicle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Vehicle</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><h2 id="middleware-integration">Middleware integration</h2>
<h3 id="grpc-services">gRPC Services</h3>
<p>Vehicle Services are expected to expose their public endpoints over the gRPC protocol. The related protobuf definitions are used to generate Python method stubs for the Vehicle Model to make it possible to call the methods of the Vehicle Services.</p>
<h3 id="model-integration">Model integration</h3>
<p>Based on the <code>.proto</code> files of the Vehicle Services, the protocol buffers compiler generates special Python descriptors for all rpcs, messages, fields etc.
The gRPC stubs are wrapped by a <strong>convenience layer</strong> class derived from <code>Service</code> that contains all the methods of the underlying protocol buffer specification.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SeatService</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Service</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_stub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SeatsStub</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">channel</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Move</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">seat</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_stub</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Move</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">MoveRequest</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">seat</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">seat</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">metadata</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">metadata</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">response</span>
</span></span></code></pre></div><h3 id="service-discovery">Service discovery</h3>
<p>The underlying gRPC channel is provided and managed by the Service base class of the SDK. It is also responsible for routing the method invocation to the service through dapr middleware. As a result, a <code>dapr-app-id</code> has to be assigned to every <code>Service</code>, so that dapr can discover the corresponding vehicle services. This <code>dapr-app-id</code> has to be specified as an environment variable named <code>&lt;service_name&gt;_DAPR_APP_ID</code>.</p>
<h2 id="fluent-query--rule-construction">Fluent query &amp; rule construction</h2>
<p>A set of query methods like <code>get()</code>, <code>where()</code>, <code>join()</code> etc. are provided through the <code>Model</code> and <code>DataPoint</code> base classes. These functions make it possible to construct SQL-like queries and subscriptions in a fluent language, which are then transmitted through the gRPC interface to the Vehicle Data Broker.</p>
<h3 id="query-examples">Query examples</h3>
<p>The following examples show you how to query data points.</p>
<h4 id="get-single-datapoint">Get single datapoint</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000">driver_pos</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vehicle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Cabin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DriverPosition</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Call to broker:</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># GetDataPoint(rule=&#34;SELECT Vehicle.Cabin.DriverPosition&#34;)</span>
</span></span></code></pre></div><h4 id="get-datapoints-from-multiple-branches">Get datapoints from multiple branches</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000">vehicle_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vehicle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CurrentLocation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Latitude</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vehicle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CurrentLocation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Longitude</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Latitude</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#000">vehicle_data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CurrentLocation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Latitude</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Longitude</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#000">vehicle_data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CurrentLocation</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Longitude</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Call to broker:</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># GetDataPoint(rule=&#34;SELECT Vehicle.CurrentLocation.Latitude, CurrentLocation.Longitude&#34;)</span>
</span></span></code></pre></div><h3 id="subscription-examples">Subscription examples</h3>
<h4 id="subscribe-and-unsubscribe-to-a-single-datapoint">Subscribe and Unsubscribe to a single datapoint</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">rule</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Cabin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Seat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">element_at</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Position</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">on_seat_position_change</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">on_seat_position_change</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span> <span style="color:#000">position</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#39;Seat position changed to </span><span style="color:#4e9a06">{</span><span style="color:#000">position</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Call to broker:</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Subscribe(rule=&#34;SELECT Vehicle.Cabin.Seat.Row2.Pos1.Position&#34;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># If needed, the subscription can be stopped like this:</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">rule</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subscription</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">unsubscribe</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><h4 id="subscribe-to-a-single-datapoint-with-a-filter">Subscribe to a single datapoint with a filter</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000">vehicle</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Cabin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Seat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">element_at</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Position</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">where</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;Cabin.Seat.Row2.Pos1.Position &gt; 50&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">on_seat_position_change</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">on_seat_position_change</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span> <span style="color:#000">position</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#39;Seat position changed to </span><span style="color:#4e9a06">{</span><span style="color:#000">position</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Call to broker:</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Subscribe(rule=&#34;SELECT Vehicle.Cabin.Seat.Row2.Pos1.Position WHERE Vehicle.Cabin.Seat.Row2.Pos1.Position &gt; 50&#34;)</span>
</span></span></code></pre></div><h2 id="publish--subscribe-messaging">Publish &amp; subscribe messaging</h2>
<p>The SDK supports publishing messages to a MQTT broker and subscribing to topics of a MQTT broker. By leveraging the dapr pub/sub building block for this purpose, the low-level MQTT communication is abstracted away from the <code>Vehicle App</code> developer. Especially the physical address and port of the MQTT broker is no longer configured in the <code>Vehicle App</code> itself, but rather is part of the dapr configuration, which is outside of the <code>Vehicle App</code>.</p>
<h3 id="publish-mqtt-messages">Publish MQTT Messages</h3>
<p>MQTT messages can be published easily with the <code>publish_mqtt_event()</code> method, inherited from <code>VehicleApp</code> base class:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish_mqtt_event</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;seatadjuster/currentPosition&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dumps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">req_data</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><h3 id="subscribe-to-mqtt-topics">Subscribe to MQTT Topics</h3>
<p>Subscriptions to MQTT topics can be easily established with the <code>subscribe_topic()</code> annotation. The annotation needs to be applied to a method of the <code>Vehicle App</code> class.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@subscribe_topic</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;seatadjuster/setPosition/request&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">on_set_position_request_received</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loads</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Set Position Request received: data=</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Under the hood, the vehicle app creates a grpc endpoint on port <code>50008</code>, which is exposed to the dapr middleware. The dapr middleware will then subscribe to the MQTT broker and forward the messages to the vehicle app.</p>
<p>To change the app port, set it in the <code>main()</code> method of the app:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">conf</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">conf</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DAPR_APP_PORT</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">your</span> <span style="color:#000">port</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>
</span></span></code></pre></div><h2 id="vehicle-app-abstraction">Vehicle App abstraction</h2>
<p><code>Vehicle Apps</code> are inherited from the <code>VehicleApp</code> base class. This enables the <code>Vehicle App</code> to use the Publish &amp; subscribe messaging and the Vehicle Data Broker.</p>
<p>The <code>Vehicle Model</code> instance is passed to the <code>__init__</code> method of the <code>VehicleApp</code> class and should be stored in a <code>self.vehicle</code> attribute, to be used in event handler functions.</p>
<p>Finally, the <code>run()</code> method of the <code>VehicleApp</code> class is called to start the <code>Vehicle App</code> and register all MQTT topic and Vehicle Data Broker subscriptions. The subscriptions are based on <code>asyncio</code>, which makes it necessary to call the <code>run()</code> method with an active <code>asyncio event_loop</code>.</p>
<p>A typical skeleton of a <code>Vehicle App</code> looks like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">```</span><span style="color:#000">Python</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SeatAdjusterApp</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">VehicleApp</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vehicle</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Vehicle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vehicle</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">seat_adjuster_talent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SeatAdjusterApp</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">vehicle</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">seat_adjuster_talent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOOP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_event_loop</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOOP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_signal_handler</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">signal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SIGTERM</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">LOOP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stop</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOOP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run_until_complete</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">main</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOOP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">close</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b22e3deec09013424a1cf54e716bd28f">1.3 - Runtime and Deployment Model</h1>
    <div class="lead">Learn more about our deployment model and guiding principles.</div>
	<p>The Velocitas project uses a common deployment model. It uses OCI-compliant containers to increase the flexibility for the support of different programming languages and runtimes, which accelerates innovation and development. OCI-compliant containers also allow for a standardized yet flexible deployment process, which increases the ease of operation. Using OCI-compliant is portable to different architectures as long as there is support for OCI-compliant containers on the desired platform (e.g., like a container runtime for arm32, arm64 or amd64).</p>
<h2 id="guiding-principles">Guiding principles</h2>
<p>The deployment model is guided by the following principles</p>
<ul>
<li>Applications are provided as OCI-compatible container images.</li>
<li>The container runtime offers a Kubernetes-compatible control plane and API to manage the container lifecycle.</li>
<li>Helm charts are used as deployment descriptor specification.</li>
</ul>
<p>The template projects provided come with a preconfigured developer toolchain that accelerates the development process. The developer toolchain ensures an easy creation through a high-degree of automation, of all required artifacts which are needed to follow the Velocitas principles.</p>
<h2 id="testing-your-container-during-development">Testing your container during development</h2>
<p>The Velocitas project provides developers with a repository template and devcontainer that contains everything to build a containerized version of your app locally and test it. Check out our tutorial e.g., for python template (<a href="https://github.com/eclipse-velocitas/vehicle-app-python-template">https://github.com/eclipse-velocitas/vehicle-app-python-template</a>) to learn more.</p>
<h2 id="automated-container-image-builds">Automated container image builds</h2>
<p>Velocitas uses GitHub workflows to automate the creation of your containerized application. A workflow is started with every increment of your application code that you push to your GitHub repository. The workflow creates a containerized version of your application and stores this container image in a registry. Further actions are carried out using this container (e.g., integration tests).</p>
<p>The workflows are set up to support multi-platform container creation and generate container images for amd64 and arm64 out of the box. This provides a great starting point for developers and lets you add additional support for further platforms easily.</p>
<p>Learn more about the concepts of the <a href="/docs/velocitas/docs/vehicle_app_releases.md">Velocitas build and release workflows</a> and check out the example GitHub workflows in our repositories for python (<a href="https://github.com/eclipse-velocitas/vehicle-app-python-template/blob/main/.github/workflows/ci.yml)">https://github.com/eclipse-velocitas/vehicle-app-python-template/blob/main/.github/workflows/ci.yml)</a>.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li><a href="/docs/getting-started/tutorials/tutorial_how_to_deploy_a_vehicle_app_with_helm/">Walkthrough: Deploy a Python Vehicle App with Helm</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-da1f21767304bce723a2d04d2f5058f7">1.4 - Build and Release Process</h1>
    <div class="lead">Learn more about the provided continuous integration, and release process of a Vehicle App.</div>
	<p>The Velocitas project provides a two-stage process for the development, continuous integration, and release of a new version of a Vehicle App.</p>
<ul>
<li>
<p><strong>Stage 1 - Build &amp; Test</strong>
On every new push to the <code>main</code> branch, a GitHub workflow is automatically executed to build your application as a container (optionally for different platforms), runs automated tests and code quality checks, and stores all results as GitHub artifacts or in a container registry for future reference.</p>
<p>The workflow provides quick feedback during development and improves efficient collaboration.</p>
</li>
<li>
<p><strong>Stage 2 - Release</strong>
Once the application is ready to be released in a new version, a dedicated release workflow is automatically executed as soon as you create a new release via GitHub.</p>
<p>The workflow bundles all relevant artifacts into one tagged set of files and makes it possible to push this information to the preferred OTA (over-the-air update) system of your choice or use the information for quality assurance and documentation.</p>
</li>
</ul>
<p>The following illustrates the different workflows, actions and artifacts that are automatically created for you. Both workflows are intended as a sensible baseline and can be extended and adapted to your own project&rsquo;s needs.</p>
<p><img src="/assets/publish_container.png" alt=""></p>
<h2 id="ci-workflow-ciyml">CI Workflow (ci.yml)</h2>
<p>The <code>CI workflow</code> is triggered on every commit to the main branch and contains a set of different actions that cover:</p>
<ul>
<li><strong>Building a container for the app</strong> - actions create a containerized version of the Vehicle App, the actions also support creating an image for multiple platforms.</li>
<li><strong>Scanning for vulnerabilities</strong> - actions scan your code and container for vulnerabilities and in case of findings the workflow will be marked as &ldquo;failed&rdquo;.</li>
<li><strong>Running unit tests &amp; code coverage</strong> - actions run unit tests and calculate code coverage for your application, in case of errors or unsatisfactory code coverage, the workflow will be marked as &ldquo;failed&rdquo;.</li>
<li><strong>Running integration tests</strong> - actions provision a runtime and deploy all required services as containers together with your containerized application to allow for automatically executing integration test cases. In case the test cases fail, the workflow will be marke as &ldquo;failed&rdquo;.</li>
<li><strong>Storing scan &amp; test results as GitHub action artifacts</strong> - actions store results from the previously mentioned actions for further reference or download as Github Action Artifacts.</li>
<li><strong>Publish container images to GitHub Container Registry</strong> - at the end of the workflow, the container images created are stored in a Github Container Registry so that they can be referenced by the release-workflow later.</li>
</ul>
<h2 id="release-workflow-releaseyml">Release Workflow (release.yml)</h2>
<p>The <code>Release workflow</code> is triggered as soon as the <code>main</code> branch is ready for release and the Vehicle App developer creates a new GitHub release. This can be done manually through the GitHub UI.</p>
<p>On creating a new release with a specific new version, GitHub creates a tag and automatically runs the <code>Release workflow</code> defined in .github/workflows/release.yml, given that <code>CI workflow</code> has run successfully for the current commit on the main branch.</p>
<p>The set of actions included in the <code>Release workflow</code> cover:</p>
<ul>
<li><strong>Generating and verifying QA information</strong> - actions load the QA information from GitHub artifacts stored for the same commit reference and verify it. Additionally, release documentation is generated and added to the GitHub release. If there is no information available for the current commit, the release workflow will fail.</li>
<li><strong>Pull &amp; label container image</strong> - actions pull the Vehicle App container image based on the current commit hash from the GitHub registry and label it with the specified tag version. If the image cannot be found, the workflow will fail.</li>
<li><strong>Publish to container registry</strong> - actions publish your container image and helm charts to your preferred container registry, which is referenced by your preferred OTA (over-the-air update) system.</li>
</ul>
<h2 id="github-actions-artifacts">GitHub Actions artifacts</h2>
<p><strong>GitHub Actions artifacts</strong> are used for storing data, which is generated by the <code>CI workflow</code> and referenced by the <code>Release workflow</code>. This saves time during workflow runs because we don&rsquo;t have to create artifacts multiple times.</p>
<p>GitHub Actions artifacts always have a retention period, which is 90 days per default, but may be configured differently in the specific GitHub organization. After this period, the QA info gets purged automatically. If that is the case, a re-run of the CI workflow is required to re-generate the QA info, afterwards a release can be created.</p>
<h2 id="container-registry">Container Registry</h2>
<p>The GitHub container registry is used for storing container images, which are generated by the <code>CI workflow</code> and leveraged by the <code>Release workflow</code>.</p>
<p>The <strong>GitHub container registry</strong> does not have an automatic cleanup and keeps container images as long as they are not deleted. It is recommended that you automate the removal of older images to limit storage size and costs.</p>
<h2 id="further-information">Further information</h2>
<h3 id="versioning">Versioning</h3>
<p>Vehicle App image versions are set to the Git tag name during release. Though any versioning scheme can be adopted, the usage of <a href="https://semver.org/">semantic versions</a> is recommended.</p>
<p>If the tag name contains a semantic version, the leading <code>v</code> will be trimmed.
<strong>Example:</strong> A tag name of <code>v1.0.0</code> will lead to version <code>1.0.0</code> of the Vehicle App container.</p>
<h3 id="maintaining-multiple-versions">Maintaining multiple versions</h3>
<p>If there is a need to maintain multiple versions of a Vehicle App, e.g., to hotfix the production version while working on a new version at the same time or to support multiple versions in production, create and use <code>release branches</code>.</p>
<p>The release process would be the same as described in the overview, except that a release branch (e.g., <code>release/v1.0</code>) is created before the release step and the GitHub release is based on the <code>release</code> branch rather than the <code>main</code> branch. For hotfixes, release branches may be created retroactively from the release tag, if needed.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8dbd4e302cd86a4d0f71f71ce3b300de">2 - Tutorials</h1>
    <div class="lead">Learn how to get started with Eclipse Velocity™, including setting up the development enviroment, creating a Vehicle Model as well as developing, testing and deploying a Vehicle App.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-836220d69d36433f11749c9a6b5b96eb">2.1 - Quickstart</h1>
    <div class="lead">Learn how to setup and explore the provided development environment.</div>
	<p>The following information describes how to setup and configure the Development Container (DevContainer), and how to build, customize and test the sample Vehicle App, which is included in this repository. You will learn how to use the Vehicle App SDK, how to interact with the vehicle API and how to do CI/CD using the pre-configured GitHub workflows that come with the repository.</p>
<p>Once you have completed all steps, you will have a solid understanding of the Development Workflow and you will be able to reuse the <a href="https://github.com/eclipse-velocitas/vehicle-app-python-template">Template Repository</a> for your own Vehicle App develpment project.</p>
<h2 id="vehicle-app-development-with-visual-studio-code">Vehicle App Development with Visual Studio Code</h2>
<p>The Visual Studio Code <a href="https://code.visualstudio.com/docs/remote/create-dev-container#:~:text=%20Create%20a%20development%20container%20%201%20Path,additional%20software%20in%20your%20dev%20container.%20More%20">Development Containers</a> makes it possible to package a complete Vehicle App development environment, including Visual Studio Code extensions, Vehicle App SDK, Vehicle App runtime and all other development &amp; testing tools into a container that is then started within your Visual Studio Code session.</p>
<p>To be able to use the DevContainer, you have to make sure that you fulfill the following prerequisites:</p>
<h3 id="system-prerequisites">System prerequisites</h3>
<ul>
<li>Install Docker Engine / <a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
<li>Install <a href="https://code.visualstudio.com">Visual Studio Code</a></li>
<li>Add <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">Remote-Containers</a> extension via the marketplace or using the command line
<pre tabindex="0"><code>code --install-extension ms-vscode-remote.remote-containers
</code></pre></li>
</ul>
<h3 id="proxy-configuration">Proxy Configuration</h3>
<p>A non proxy configuration is used by default.
If you are working behind a corporate proxy you will need to specify proxy settings.</p>
<details>
<summary>Please expand for information on configuring proxy settings</summary>
<p>A template configuration using proxies exists in <code>.devcontainer/Dockerfile.Proxy</code> and by setting the environment variable <code>DEVCONTAINER_PROXY</code> to <code>.Proxy</code> the file
<code>.devcontainer/Dockerfile.Proxy</code> will be used instead of <code>.devcontainer/Dockerfile</code>.</p>
<p>The template configuration uses the following default configuration:</p>
<pre tabindex="0"><code>ENV HTTP_PROXY=&#34;http://172.17.0.1:${PROXY_PORT:-3128}&#34;
</code></pre><ul>
<li>If your proxy is not available on <code>172.17.0.1</code> then you must modify <code>.devcontainer/Dockerfile.Proxy</code>.</li>
<li>If your proxy does not use 3128 as port you can set another port in the environment variable <code>DEVCONTAINER_PROXY_PORT</code></li>
</ul>
<h4 id="windows">Windows:</h4>
<ol>
<li>Edit environment variables for your account</li>
<li>Create an environment variable with name the <code>DEVCONTAINER_PROXY</code> and with the value <code>.Proxy</code> for your account
<ul>
<li>Don&rsquo;t forget (dot) in value of the environment variable</li>
</ul>
</li>
<li>If you are using a different Port than 3128 for your Proxy, you have to set another environment variable as follows:
<ul>
<li>DEVCONTAINER_PROXY_PORT=<PortNumber></li>
</ul>
</li>
<li>Restart Visual Studio Code to pick up the new environment variable</li>
</ol>
<h4 id="macos--linux">macOS &amp; Linux:</h4>
<pre tabindex="0"><code>echo &#34;export DEVCONTAINER_PROXY=.Proxy&#34; &gt;&gt; ~/.bash_profile
source ~/.bash_profile
</code></pre><h3 id="proxy-troubleshooting">Proxy Troubleshooting</h3>
<p>If you experience issues during initial DevContainer build and you want to start over, then you want to make sure you clean all images and volumes in Docker Desktop, otherwise cache might be used. Use the Docker Desktop UI to remove all volumes and containers.</p>
<p>Proxy settings in <code>~/.docker/config.json</code> will override settings in <code>.devcontainer/Dockerfile.Proxy</code>, which can cause problems.
In case the DevContainer is still not working, check if proxy settings are set correctly in the Docker user profile (<code>~/.docker/config.json</code>), see <a href="https://docs.docker.com/network/proxy/">Docker Documentation</a> for more details.
Verify that the <code>noProxy</code> setting in <code>~/.docker/config.json</code> (if existing) is compatible with the setting of <code>NO_PROXY</code> in <code>.devcontainer/Dockerfile.Proxy</code>.
The development environment relies on communication to localhost (e.g. localhost, 127.0.0.1) and it is important that the proxy setting is correct so that connections to localhost are not forwarded to the proxy.</p>
</details>
<h2 id="use-template-repository">Use Template Repository</h2>
<p>Create your own repository copy from the <a href="https://github.com/eclipse-velocitas/vehicle-app-python-template">Template Repository</a> by clicking the green button <code>Use this template</code>. You don&rsquo;t have to include all branches.</p>
<p>The name <code>MyOrg/MyFirstVehicleApp</code> is used as a reference during the rest of document.</p>
<p>For more information on Template Repositories take a look at this <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-repository-from-a-template">GitHub Tutorial</a></p>
<p>In the following you will learn different possibilities to work with the repo. Basically you can work on your own machine using just Visual Studio Code or you can set up the environment on a remote agent, using <a href="https://github.com/features/codespaces">GitHub Codespaces</a>.</p>
<h3 id="visual-studio-code">Visual Studio Code</h3>
<p>With following steps you will clone and set up your development environment on your own machine using just Visual Studio Code.</p>
<ol>
<li>Start Visual Studio Code</li>
<li>Press <kbd>F1</kbd> and run the command <code>Remote-Containers: Clone Repository within Container Volume...</code></li>
<li>Select <code>Clone a repository from GitHub in a Container Volume</code> and choose the repository / branch to clone</li>
<li>Enter the GitHub organization and repository name (e.g. <code>MyOrg/MyFirstVehicleApp</code>) and select the repository from the list</li>
<li>Select the branch to clone from the list</li>
</ol>
<p>The first time initializing the container will take a few minutes to build the image and to provision the tools inside the container.</p>
<blockquote>
<p>When opening the DevContainer for the first time, the following steps are necessary:</p>
</blockquote>
<ul>
<li>A manual reload of the dapr extension is required, if the extension hasn´t been installed before (Note: the reload button appears next to Dapr extension in extension menue).</li>
</ul>
<details>
<summary>Please expand for information on troubleshooting</summary>
<blockquote>
<p>If Visual Studio Code fails to directly clone your repository you can also use a workaround:</p>
<ol>
<li>clone the repo locally using your favorite Git tooling</li>
<li>Start Visual Studio Code</li>
<li>select <code>Open Folder</code> from the <code>File</code> menu</li>
<li>open the root of the cloned repo</li>
<li>a popup appears on the lower left side of Visual Studio Code</li>
<li>click on <code>Reopen in Container</code></li>
<li>wait for the container to be set up</li>
</ol>
<p>If the popup does not appear, you can also hit <kbd>F1</kbd> and run the command <code>Remote-Containers: Open Folder in Container</code></p>
</blockquote>
<blockquote>
<p>If the development container fails to build successfully (e.g. due to network issues), then wait for the current build to finish, press <kbd>F1</kbd> and run the command <code>Remote-Containers: Rebuild Container Without Cache</code></p>
</blockquote>
<p>The devContainer is using the <a href="https://github.com/microsoft/vscode-dev-containers/blob/main/script-library/docs/docker-in-docker.md">docker-in-docker</a>-feature to run docker containers within the container. Currently, this feature has the limitation that only one instance of a devContainer with the feature enabled can be running at the same time.</p>
</details>
<h3 id="codespaces">Codespaces</h3>
<p>Another possibility to use your newly created repository is via <a href="https://github.com/features/codespaces">GitHub Codespaces</a>.
You can either try it out directly in the browser or also use it inside Visual Studio Code. The main thing to remember is that everything is executed on a remote agent and the browser or Visual Studio Code just act as frontends.</p>
<p>To get started with Codespaces, you just have to follow a few steps:</p>
<ol>
<li>go to the webpage of your repository on GitHub (e.g. <a href="https://github.com/MyOrg/MyFirstVehicleApp">https://github.com/MyOrg/MyFirstVehicleApp</a>)</li>
<li>click on the green <code>Code</code>-button and select Codespaces on the top</li>
<li>configure your Codespace if needed (defaults to the main branch and a standard agent)</li>
<li>click on <code>create</code></li>
</ol>
<p>A new window will open where you see the logs for setting up the container. On this window you could now also choose to work with Visual Studio Code. The environment remains on a remote agent and Visual Studio Code establishes a connection to this machine.</p>
<p>Once everything is set up in the Codespace, you can work with it in the same way as with the normal DevContainer inside Visual Studio Code.</p>
<h2 id="starting-runtime-services">Starting runtime services</h2>
<p>The runtime services (like <em>Vehicle Data Broker</em> or <em>Vehicle Services</em>) are required to develop vehicle apps and run integration tests.</p>
<p>A Visual Studio Code task called <code>Start Vehicle App runtime</code> is available to run these in the correct order. Click <code>F1</code>, select command <code>Tasks: Run Task</code>, select <code>Start VehicleApp runtime</code> and <code>Continue without scanning the output</code>.</p>
<p>You should see the tasks <code>run-mosquitto</code>, <code>run-vehicledatabroker</code>, <code>run-seatservice</code> and <code>run-feedercan</code> being executed in the Visual Studio Code output panel.</p>
<p>More information about the tasks are available <a href="/docs/run_runtime_services_locally.md">here</a>.</p>
<h2 id="start-and-test-vehicle-app">Start and test Vehicle App</h2>
<p>Now that your DevContainer is up and running, it is time to take a look at what&rsquo;s inside:</p>
<ul>
<li>Vehicle App - This sample app is a basic blueprint and illustrates how to interact with the VAL Services and the Vehicle App SDK.</li>
<li>Mosquitto MQTT Broker - The broker allows for interaction with other Vehicle Apps or the cloud and is used by the Vehicle App. The MQTT broker is running inside a docker image which is started automatically after starting the DevContainer.</li>
</ul>
<h3 id="start-and-check-vehicle-app">Start and check Vehicle App</h3>
<p>Let&rsquo;s start the sample Vehicle App to verify that you receive actual data from the API.</p>
<p>Open a new terminal and start the Vehicle App with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dapr run --app-id seatadjuster --app-protocol grpc --app-port <span style="color:#0000cf;font-weight:bold">50008</span> --config ./.dapr/config.yaml --components-path ./.dapr/components  python3 ./src/SeatAdjusterApp/seatadjuster.py
</span></span></code></pre></div><p>Once the Vehicle App is started, you can expect to receive the Current Position of the Vehicle Seat, which should be reported as 420.</p>
<p>You will see messages such as</p>
<pre tabindex="0"><code>== APP == 04/06/2022 07:31:58 AM - __main__ - INFO - Current Position of the Vehicle Seat is: {&#39;position&#39;: 420}
</code></pre><p>To stop the Vehicle App instance: close the terminal window by hitting <kbd>Ctrl + C</kbd>.</p>
<h3 id="debug-vehicle-app">Debug Vehicle App</h3>
<p>After VAL Services and Vehicle App are running successfully, let&rsquo;s start a debug session for the Vehicle App as next step.</p>
<ul>
<li>Open the main python file <code>src/SeatAdjusterApp/seatadjuster.py</code> file and set a breakpoint in <code>line 68</code></li>
<li>Press <kbd>F5</kbd> to start the Vehicle App to start a debug session and see the log output on the <code>DEBUG CONSOLE</code></li>
</ul>
<p>In the next step you will use a mqtt message to trigger this breakpoint.</p>
<h3 id="send-mqtt-messages-to-vehicle-app">Send MQTT messages to Vehicle App</h3>
<p>Let&rsquo;s send a message to your Vehicle App using the mqtt broker that is running in the background.</p>
<ul>
<li>
<p>Make sure, Vehicle Api Mock and Seat Adjuster App are running.</p>
</li>
<li>
<p>Open <code>VSMqtt</code> extension in Visual Studio Code and connect to <code>mosquitto (local)</code></p>
</li>
<li>
<p>Set <code>Subscribe Topic</code> = <code>seatadjuster/setPosition/response</code> and click subscribe.</p>
</li>
<li>
<p>Set <code>Subscribe Topic</code> = <code>seatadjuster/currentPosition</code> and click subscribe.</p>
</li>
<li>
<p>Set <code>Publish Topic</code> = <code>seatadjuster/setPosition/request</code></p>
</li>
<li>
<p>Set and publish a dummy payload:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;position&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">300</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;xyz&#34;</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
<li>
<p>Now your breakpoint in the Vehicle App gets hit and you can inspect everything in your debug session</p>
</li>
<li>
<p>After resuming execution (<kbd>F5</kbd>), a response from your Vehicle App is published to the response topic</p>
</li>
<li>
<p>You can see the response in the MQTT window.</p>
</li>
</ul>
<h2 id="trigger-your-github-workflows">Trigger your Github Workflows</h2>
<p>GitHub workflows are used to build the container image for the Vehicle App, run unit and integration tests, collect the test results and create a release documentation and publish the Vehicle App. A detailed description of the workflow you can find <a href="https://github.com/eclipse-velocitas/velocitas-docs/blob/main/docs/vehicle_app_releases.md">here</a>.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>In order to run the workflow succesfully inside the SDV-Org, we are using a PAT of the technical user <code>swd9be</code>. He needs write access to all repos created from the template repository. Furthermore this user needs read access to the following repositories:</p>
<ul>
<li>vehicle-app-python-sdk</li>
<li>vehicle-model-python</li>
<li>license-check</li>
</ul>
<p>When using the template outside of the SDV-Org some additional steps need to be done:</p>
<ol>
<li><a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">create a personal access token</a>
<ul>
<li>needs write access to your repo</li>
</ul>
</li>
<li><a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">create a secret</a>
<ul>
<li>Name must be <code>SDV_GITHUB_AUTOMATION_TOKEN</code></li>
</ul>
</li>
<li>paste the PAT into the secret</li>
</ol>
<h3 id="run-github-workflow">Run GitHub Workflow</h3>
<ul>
<li>Make modification to your file, e.g. remove the last empty line from <code>src/SeatAdjusterApp/seatadjuster.py</code></li>
<li>Commit you change
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git add .
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#4e9a06">&#34;removed emtpy line&#34;</span>
</span></span></code></pre></div></li>
<li>Push
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git push
</span></span></code></pre></div></li>
<li>Open your git repository in your favorite browser</li>
<li>Navigate to <code>Actions</code> and go to <a href="https://github.com/eclipse-velocitas/vehicle-app-python-template/blob/main/.github/workflows/ci.yml">CI Workflow</a></li>
<li>Check Workflow Output, it should look like this:
<img src="/assets/ci-workflow-success.png" alt=""></li>
</ul>
<h2 id="build-you-first-release">Build you first release</h2>
<p>Now that the <code>CI Workflow</code> was successful, you are ready to build your first release. Your goal is to build a ready-to-deploy container image.</p>
<h3 id="release-the-vehicle-app-to-push-it-to-the-container-registry">Release the Vehicle App to push it to the container registry</h3>
<ul>
<li>In order to deploy the Vehicle App you need to configure the container registry credentials first:
<ul>
<li>Open <code>Settings</code>, go to <code>Secrets</code>, click on <code>Manage your environments and add repository secrets</code> and add the following secret (button <code>Add Secret</code>):
<ul>
<li>Name: OTA_SYSTEM_CREDENTIALS</li>
<li>Value:
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;CONTAINER_REGISTRY &#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;your container registry&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;REGISTRY_USER &#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;your username&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;REGISTRY_PASSWORD  &#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;your password&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>Open the <code>Code</code> page of your repository on GitHub.com and click on <code>Create a new release</code> in the Releases section on the right side</li>
<li>Enter a version and click on <code>Publish release</code>
<ul>
<li>Note: you can start the verion with a <code>v</code> which will be removed though, e.g. &ldquo;v1.0.0&rdquo; will result in a &ldquo;1.0.0&rdquo; (see <a href="https://github.com/battila7/get-version-action">vesion-without-v</a>).</li>
</ul>
</li>
<li>The release workflow will be triggered
<ul>
<li>Open <code>Actions</code> on the repoitory and see the result</li>
</ul>
</li>
</ul>
<h2 id="next-steps">Next steps</h2>
<ul>
<li><a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_app.md">Walkthrough: Create a Python Vehicle App</a></li>
<li><a href="/docs/run_runtime_services_kubernetes.md">Deploy runtime services in Kubernetes mode</a></li>
<li><a href="/docs/integration_tests.md">Develop and run integration tests for a Vehicle App</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3999eec4307d02364111550f29f4ea06">2.2 - Python Vehicle Model Creation</h1>
    <div class="lead">Learn how to create a simple Python Vehicle Model with Visual Studio Code and the Python Vehicle App SDK.</div>
	<blockquote>
<p>We recommend that you make yourself familiar with the <a href="/docs/python-sdk//python_vehicle_app_sdk_overview.md">Python Vehicle App SDK Overview</a> first, before going through this tutorial.</p>
</blockquote>
<p>This tutorial will show you how to:</p>
<ul>
<li>Set up a Python Package</li>
<li>Create a Python Vehicle Model</li>
<li>Add Vehicle Services</li>
<li>Distribute your Python Vehicle Model</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a> with the <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">Python extension</a> installed. For information on how to install extensions on Visual Studio Code, see <a href="https://code.visualstudio.com/docs/editor/extension-gallery">VS Code Extension Marketplace</a>.</li>
</ul>
<h2 id="create-a-python-vehicle-model">Create a Python Vehicle Model</h2>
<p>A Vehicle Model should be defined in its own Python Package. This makes it possible to distribute the Vehicle Model later as a standalone package and to use it in different <em>Vehicle App</em> projects.
A Vehicle Model can be created in one of two ways.</p>
<ul>
<li>
<h3 id="create-a-python-vehicle-model-from-vss-specification">Create a Python Vehicle Model from VSS specification</h3>
<p>A Vehicle Model can be generated from the VSS spec. <a href="https://github.com/eclipse-velocitas/vehicle-model-generator">vehicle-model-generator</a> creates a Vehicle Model from the given vspec specification and also generates a package for use in <em>Vehicle App</em> projects.</p>
<p>Follow the steps to generate a Vehicle Model.</p>
<ol>
<li>
<p>Clone the <a href="https://github.com/eclipse-velocitas/vehicle-model-generator">vehicle-model-generator</a> repository in a container volume.</p>
</li>
<li>
<p>In this container volume, clone the <a href="https://github.com/COVESA/vehicle_signal_specification">vehicle-signal-specification</a> repository.</p>
<pre tabindex="0"><code>git clone https://github.com/COVESA/vehicle_signal_specification
</code></pre><p>After cloning if a user wants to refer to a particular branch they can checkout that branch afterwards.</p>
<pre tabindex="0"><code>cd vehicle_signal_specification
git checkout &lt;branch-name&gt;
</code></pre></li>
<li>
<p>Execute the command</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 gen_vehicle_model.py -I ./vehicle_signal_specification/spec ./vehicle_signal_specification/spec/VehicleSignalSpecification.vspec -T sdv_model -N sdv_model
</span></span></code></pre></div><p>This creates a <code>sdv_model</code> directory in the root of repository along with a <code>setup.py</code> file.
To have a custom model name, refer to README of <a href="https://github.com/eclipse-velocitas/vehicle-model-generator">vehicle-model-generator</a> repository.</p>
</li>
<li>
<p>Change the version of package in <code>setup.py</code> manually (defaults to 0.1.0).</p>
</li>
<li>
<p>Now the newly generated <code>sdv_model</code> can be used for distribution. (See <a href="#distributing-your-python-vehicle-model">Distributing your Python Vehicle Model</a>)</p>
</li>
</ol>
</li>
<li>
<h3 id="create-a-python-vehicle-model-manually">Create a Python Vehicle Model Manually</h3>
<h4 id="setup-a-python-package-manually">Setup a Python Package manually</h4>
<p>A Vehicle Model should be defined in its own Python Package. This allows to distribute the Vehicle Model later as a standalone package and to use it in different <em>Vehicle App</em> projects.</p>
<p>The name of the Vehicle Model package will be <code>my_vehicle_model</code> for this walkthrough.</p>
<ol>
<li>
<p>Start Visual Studio Code</p>
</li>
<li>
<p>Select <strong>File &gt; Open Folder (File &gt; Open</strong>&hellip; on macOS) from the main menu.</p>
</li>
<li>
<p>In the Open Folder dialog, create a <code>my_vehicle_model</code> folder and select it. Then click Select Folder (Open on macOS).</p>
</li>
<li>
<p>Create a new file <code>setup.py</code> under <code>my_vehicle_model</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">setuptools</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">setup</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">setup</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;my_vehicle_model&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">version</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;0.1&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;My Vehicle Model&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">packages</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;my_vehicle_model&#39;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">zip_safe</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>This is the Python package distribution script.</p>
</li>
<li>
<p>Create an empty folder <code>my_vehicle_model</code> under <code>my_vehicle_model</code>.</p>
</li>
<li>
<p>Create a new file <code>__init__.py</code> under <code>my_vehicle_model/my_vehicle_model</code>.</p>
</li>
</ol>
<p>At this point the source tree of the Python package should look like this:</p>
<pre tabindex="0"><code>my_vehicle_model
├── my_vehicle_model
│   └── __init__.py
└── setup.py
</code></pre><p>To verify that the package is created correctly, install it locally:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip3 install .
</span></span></code></pre></div><p>The output of the above command should look like this:</p>
<pre tabindex="0"><code>Defaulting to user installation because normal site-packages is not writeable
Processing /home/user/projects/my-vehicle-model
Preparing metadata (setup.py) ... done
Building wheels for collected packages: my-vehicle-model
Building wheel for my-vehicle-model (setup.py) ... done
Created wheel for my-vehicle-model: filename=my_vehicle_model-0.1-py3-none-any.whl size=1238 sha256=a619bc9fbea21d587f9f0b1c1c1134ca07e1d9d1fdc1a451da93d918723ce2a2
Stored in directory: /home/user/.cache/pip/wheels/95/c8/a8/80545fb4ff73c974ac1716a7bff6f7f753f92022c41c2e376f
Successfully built my-vehicle-model
Installing collected packages: my-vehicle-model
Successfully installed my-vehicle-model-0.1
</code></pre><p>Finally, uninstall the package again:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip3 uninstall my_vehicle_model
</span></span></code></pre></div><h4 id="add-vehicle-models-manually">Add Vehicle Models manually</h4>
<ol>
<li>
<p>Install the Python Vehicle App SDK:</p>
<pre><code>```bash
pip3 install git+https://github.com/eclipse-velocitas/vehicle-app-python-sdk.git@v0.4.0
```

The output of the above command should end with:

```bash
Successfully installed sdv-0.4.0
```
</code></pre>
<p>Now it is time to add some Vehicle Models to the Python package. At the end of this section you will have a Vehicle Model, that contains a <code>Cabin</code> model, a <code>Seat</code>model and has the following tree structure:</p>
<pre><code>Vehicle
└── Cabin
    └── Seat (Row, Pos)
</code></pre>
</li>
<li>
<p>Create a new file <code>Seat.py</code> under <code>my_vehicle_model/my_vehicle_model</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv.model</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Model</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">parent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">parent</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Position</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointFloat</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Position&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>This creates the Seat model with a single data point of type <code>float</code> named <code>Position</code>.</p>
</li>
<li>
<p>Create a new file <code>Cabin.py</code> under <code>my_vehicle_model/my_vehicle_model</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv.model</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Model</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Cabin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">parent</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">parent</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Seat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ModelCollection</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">](</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">[</span><span style="color:#000">NamedRange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Row&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">NamedRange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Pos&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)],</span> <span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>This creates the <code>Cabin</code> model, which contains a set of six <code>Seat</code> models, referenced by their rows and positions:</p>
<ul>
<li>row=1, pos=1</li>
<li>row=1, pos=2</li>
<li>row=1, pos=3</li>
<li>row=2, pos=1</li>
<li>row=2, pos=2</li>
<li>row=2, pos=3</li>
</ul>
</li>
<li>
<p>Create a new file <code>vehicle.py</code> under <code>my_vehicle_model/my_vehicle_model</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv.model</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Model</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">my_vehicle_model.Cabin</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Cabin</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Vehicle</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Model</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;&#34;&#34;Vehicle model&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Speed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DataPointFloat</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Speed&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Cabin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Cabin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">vehicle</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Vehicle</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div></li>
</ol>
<p>The root model of the Vehicle Model tree should be called <em>Vehicle</em> by convention and is specified, by setting parent to <code>None</code>. For all other models a parent model must be specified as the 2nd argument of the <code>Model</code> constructor, as can be seen by the <code>Cabin</code> and the <code>Seat</code> models above.</p>
<p>A singleton instance of the Vehicle Model called <code>vehicle</code> is created at the end of the file. This instance is supposed to be used in the Vehicle Apps. Creating multiple instances of the Vehicle Model should be avoided for performance reasons.</p>
</li>
</ul>
<h2 id="add-a-vehicle-service">Add a Vehicle Service</h2>
<p>In this section, we add the <code>SeatService</code> vehicle service to the Vehicle Model.</p>
<ol>
<li>
<p>Create a new folder <code>proto</code> under <code>my_vehicle_model/my_vehicle_model</code>.</p>
</li>
<li>
<p>Create a new file <code>seats.proto</code> under <code>my_vehicle_model/my_vehicle_model/proto</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#000">syntax</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;proto3&#34;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">sdv</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">edge.comfort.seats.v1</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">service</span> <span style="color:#000">Seats</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">Move</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">MoveRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">MoveReply</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">MoveComponent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">MoveComponentRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">MoveComponentReply</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">CurrentPosition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">CurrentPositionRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">CurrentPositionReply</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">MoveRequest</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">Seat</span> <span style="color:#000">seat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The desired seat position
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">MoveReply</span> <span style="color:#000;font-weight:bold">{}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">MoveComponentRequest</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">SeatLocation</span> <span style="color:#000">seat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The seat location to change
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">SeatComponent</span> <span style="color:#000">component</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The component position to change
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#000">position</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The desired position to move the component to
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">MoveComponentReply</span> <span style="color:#000;font-weight:bold">{}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">CurrentPositionRequest</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">uint32</span> <span style="color:#000">row</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The row of the desired seat (1 - front most)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">uint32</span> <span style="color:#000">index</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The position in the addressed row (1 - left most)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">CurrentPositionReply</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">Seat</span> <span style="color:#000">seat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The seat state that was requested
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">Seat</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">SeatLocation</span> <span style="color:#000">location</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The location of the seat in the vehicle
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">Position</span> <span style="color:#000">position</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The various positions of the seat
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">SeatLocation</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">uint32</span> <span style="color:#000">row</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The row, front 1 and +1 toward rear
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">uint32</span> <span style="color:#000">index</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The index within the row, 1 left most, +1 toward right
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">Position</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#000">base</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>    <span style="color:#8f5902;font-style:italic">// The position of the base 0 front, 1000 back
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#000">cushion</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The position of the cushion 0 short, 1000 long
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#000">lumbar</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic">// The position of the lumbar support
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#000">side_bolster</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic">// The position of the side bolster
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#000">head_restraint</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">// The position of the head restraint 0 down, 1000 up
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">enum</span> <span style="color:#000">SeatComponent</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">BASE</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">CUSHION</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">LUMBAR</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">SIDE_BOLSTER</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>    <span style="color:#000">HEAD_RESTRAINT</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span></code></pre></div><p>This is the protocol buffers message definition of the <code>SeatService</code>, which is expected to be provided by the vehicle service.</p>
</li>
<li>
<p>Install the grpcio tools including mypy types to generate the python classes out of the proto-file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip3 install grpcio-tools mypy_protobuf
</span></span></code></pre></div></li>
<li>
<p>Generate Python classes from the <code>SeatService</code> message definition:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m grpc_tools.protoc -I my_vehicle_model/proto --grpc_python_out<span style="color:#ce5c00;font-weight:bold">=</span>./my_vehicle_model/proto --python_out<span style="color:#ce5c00;font-weight:bold">=</span>./my_vehicle_model/proto --mypy_out<span style="color:#ce5c00;font-weight:bold">=</span>./my_vehicle_model/proto my_vehicle_model/proto/seats.proto
</span></span></code></pre></div><p>This creates the following grpc files under the <code>proto</code> folder:</p>
<ul>
<li>seats_pb2.py</li>
<li>seats_pb2_grpc.py</li>
<li>seats_pb2.pyi</li>
</ul>
</li>
<li>
<p>Create the <code>SeatService</code> class and wrap the gRPC service:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv.model</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">my_vehicle_model.proto.seats_pb2</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">CurrentPositionRequest</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">MoveComponentRequest</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">MoveRequest</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">SeatComponent</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">SeatLocation</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">my_vehicle_model.proto.seats_pb2_grpc</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">SeatsStub</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SeatService</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Service</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;SeatService model&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_stub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SeatsStub</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">channel</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">Move</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">seat</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Seat</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_stub</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Move</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">MoveRequest</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">seat</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">seat</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">metadata</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">metadata</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">response</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">MoveComponent</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">seatLocation</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">SeatLocation</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">component</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">SeatComponent</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">position</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_stub</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">MoveComponent</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">MoveComponentRequest</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">seat</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">seatLocation</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">component</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">component</span><span style="color:#000;font-weight:bold">,</span>  <span style="color:#8f5902;font-style:italic"># type: ignore</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">position</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">position</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">metadata</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">metadata</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">response</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">CurrentPosition</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">row</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">index</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_stub</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CurrentPosition</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">CurrentPositionRequest</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">row</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">row</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">index</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">index</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">metadata</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">metadata</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">response</span>
</span></span></code></pre></div><p>Some important remarks about the wrapping <code>SeatService</code> class
shown above:</p>
<ul>
<li>The <code>SeatService</code> class must derive from the <code>Service</code> class provided by the Python SDK.</li>
<li>The <code>SeatService</code> class must use the grpc channel from the <code>Service</code> base class and provide it to the <code>_stub</code> in the <code>__init__</code> method. This allows the SDK to manage the physical connection to the grpc service and use service discovery of the middleware.</li>
<li>Every method needs to pass the metadata from the <code>Service</code> base class to the gRPC call. This is done by passing the <code>self.metadata</code> argument to the metadata of the gRPC call.</li>
</ul>
</li>
</ol>
<h2 id="distributing-your-python-vehicle-model">Distributing your Python Vehicle Model</h2>
<p>Now you a have a Python package containing your first Python Vehicle Model and it is time to distribute it. There is nothing special about the distribution of this package, since it is just an ordinary Python package. Check out the <a href="https://packaging.python.org/en/latest/">Python Packaging User Guide</a> to learn more about packaging and package distribution in Python.</p>
<h3 id="distribute-to-single-vehicle-app">Distribute to single Vehicle App</h3>
<p>If you want to distribute your Python Vehicle Model to a single Vehicle App, you can do so by copying the entire folder <code>my_vehicle_model</code> under the <code>src</code> folder of your Vehicle App repository and treat is a sub-package of the Vehicle App.</p>
<ol>
<li>Create a new folder <code>my_vehicle_model</code> under <code>src</code> in your <code>Vehicle App</code> repository.</li>
<li>Copy the <code>my_vehicle_model</code> folder to the <code>src</code> folder of your <code>Vehicle App</code> repository.</li>
<li>Import the package <code>my_vehicle_model</code> in your <code>Vehicle App</code>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">my_app</span><span style="color:#ce5c00;font-weight:bold">&gt;.</span><span style="color:#000">my_vehicle_model</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">vehicle</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">my_app</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">MyVehicleApp</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">vehicle</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="distribute-inside-an-organization">Distribute inside an organization</h3>
<p>If you want to distribute your Python Vehicle Model inside an organization and use it to develop multiple Vehicle Apps, you can do so by creating a dedicated Git repository and copying the files there.</p>
<ol>
<li>
<p>Create new Git repository called <code>my_vehicle_model</code></p>
</li>
<li>
<p>Copy the content under <code>my_vehicle_model</code> to the repository.</p>
</li>
<li>
<p>Release the Vehicle Model by creating a version tag (e.g., <code>v1.0.0</code>).</p>
</li>
<li>
<p>Install the Vehicle Model package to your Vehicle App:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">pip3</span> <span style="color:#000">install</span> <span style="color:#000">git</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#000">https</span><span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">//</span><span style="color:#000">github</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">com</span><span style="color:#ce5c00;font-weight:bold">/&lt;</span><span style="color:#000">yourorg</span><span style="color:#ce5c00;font-weight:bold">&gt;/</span><span style="color:#000">my_vehicle_model</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">git</span><span style="color:#5c35cc;font-weight:bold">@v1</span><span style="color:#0000cf;font-weight:bold">.0.0</span>
</span></span></code></pre></div></li>
<li>
<p>Import the package <code>my_vehicle_model</code> in your Vehicle App and use it as shown in the previous section.</p>
</li>
</ol>
<h3 id="distribute-publicly-as-open-source">Distribute publicly as open source</h3>
<p>If you want to distribute your Python Vehicle Model publicly, you can do so by creating a Python package and distributing it on the <a href="https://pypi.org/">Python Package Index (PyPI)</a>. PyPi is a repository of software for the Python programming language and helps you find and install software developed and shared by the Python community. If you use the <code>pip</code> command, you are already using PyPI.</p>
<p>Detailed instructions on how to make a Python package available on PyPI can be found <a href="https://packaging.python.org/tutorials/packaging-projects/">here</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2b30ec67b931796925324af48e8e2f00">2.3 - Python Vehicle App Development</h1>
    <div class="lead">Learn how to develop and test the Vehicle App.</div>
	<blockquote>
<p>We recommend that you make yourself familiar with the <a href="/python-sdk/python_vehicle_app_sdk_overview.md">Python Vehicle App SDK</a> first, before going through this tutorial.</p>
</blockquote>
<p>The following information describes how to develop and test the sample Vehicle App that is included in the <a href="https://github.com/eclipse-velocitas/vehicle-app-python-template">template repository</a>. You will learn how to use the Vehicle App SDK and how to interact with the Vehicle Model.</p>
<p>Once you have completed all steps, you will have a solid understanding of the development workflow and you will be able to reuse the template repository for your own Vehicle App development project.</p>
<h2 id="develop-your-first-vehicle-app">Develop your first Vehicle App</h2>
<p>This section describes how to develop your first Vehicle App. Before you start building a new Vehicle App, make sure you have already read the other manuals:</p>
<ul>
<li><a href="/docs/setup_and_explore_development_environment.md">Setup and Explore Development Enviroment</a></li>
<li><a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_model.md">How to create a Vehicle Model</a></li>
</ul>
<p>Once you have established a working environment, you will be able to start developing your first Vehicle App.</p>
<p>For this purpose, we assume a usecase having a vehicle where we can change the positions of the seats and also get their current positions.</p>
<p>At first, you have to create the main python script called <code>run.py</code> in <code>src/</code>. All the relevant code for new Vehicle App goes there. Afterwards, there are several steps you need to consider when developing the app:</p>
<ol>
<li>Manage your imports</li>
<li>Enable logging</li>
<li>Initialize your class</li>
<li>Start the app</li>
</ol>
<h4 id="manage-your-imports">Manage your imports</h4>
<p>Before you start development in the <code>run.py</code> you just created, it will be necessary to include the imports required, which you will understand better later through the development:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">asyncio</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">json</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">logging</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">signal</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv.util.log</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">get_default_date_format</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">get_default_log_format</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv.vehicle_app</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">VehicleApp</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">subscribe_data_points</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">subscribe_topic</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">set_position_request_processor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">SetPositionRequestProcessor</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">vehicle_model.Vehicle</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Vehicle</span>
</span></span></code></pre></div><h4 id="enable-logging">Enable logging</h4>
<p>The following logging configuration applies the default log format provided by the SDK and sets the log level to INFO:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000">logging</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">basicConfig</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">get_default_log_format</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">datefmt</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">get_default_date_format</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span><span style="color:#000">logging</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getLogger</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">setLevel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;INFO&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">logger</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">logging</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">getLogger</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">__name__</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h4 id="initialize-your-class">Initialize your class</h4>
<p>The main class of your new Vehicle App needs to inherit the <code>VehicleApp</code> provided by the <a href="https://github.com/eclipse-velocitas/vehicle-app-python-sdk">SDK</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SeatAdjusterApp</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">VehicleApp</span><span style="color:#000;font-weight:bold">):</span>
</span></span></code></pre></div><p>In class initialization, you have to pass an instance of the Vehicle Model:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vehicle_client</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Vehicle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle_client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vehicle_client</span>
</span></span></code></pre></div><p>We save the vehicle object to use it in our app. Now, you have initialized the app and can continue developing relevant methods.</p>
<h4 id="start-the-app">Start the app</h4>
<p>Here&rsquo;s an example of how to start the SeatAdjuster App we just developed:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;&#34;&#34;Main function&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Starting seat adjuster app...&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">seat_adjuster_talent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SeatAdjusterApp</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">vehicle</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">seat_adjuster_talent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOOP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">asyncio</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_event_loop</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOOP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_signal_handler</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">signal</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SIGTERM</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">LOOP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stop</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOOP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">run_until_complete</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">main</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOOP</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">close</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>The app is now running. In order to use it properly, we will enhance the app with more features in the next sections.</p>
<h2 id="vehicle-model">Vehicle Model</h2>
<p>In order to facilitate the implementation, the whole vehicle is abstracted into model classes. Please check <a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_model.md">tutorial about creating models</a> for more details about this topic. In this section, the focus is on using the models.</p>
<h3 id="import-the-model">Import the model</h3>
<p>The first thing you need to do to get access to the Vehicle Model. In the section about <a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_model.md#distributing-your-python-vehicle-model">distributing a model</a>, you got to know the different methods.</p>
<p>If you just want to use your model in one app, you can simply copy the classes into your <code>src</code>-folder. In this example, you find the classes inside the <code>vehicle_model</code>-folder. As you have already seen in the section about <a href="/docs/getting-started/tutorials/tutorial_how_to_create_a_vehicle_app/#initialize-your-class">initializing the app</a>, we need the <code>vehicle model</code>to use the app.</p>
<p>As you know, the model has a single <a href="#datapoints">Datapoint</a> for the speed and a reference to the <code>cabin</code>-model.</p>
<p>Accessing the speed can be done via</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000">vehicle_speed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle_client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Speed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>As the <code>get</code>-method of the Datapoint-class there is a coroutine and you have to use the <code>await</code> keyword when using it.</p>
<p>If you want to get deeper inside the vehicle, to access a single seat for example, you just have to go the model-chain down:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DriverSeatPosition</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle_client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Cabin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Seat</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Row1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Pos1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Position</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><h2 id="subscribtion-to-datapoints">Subscribtion to Datapoints</h2>
<p>As you have already seen in the Vehicle Models, <code>Datapoints</code> are objects that contain just a single type of data. You can also use them directly in your app as already seen in the section above with the example of the vehicle speed.</p>
<p>If you want to get notified about the changes of a <code>Datapoint</code>, you can subscribe to this event. To get notified when, for example, the position of a seat changes, you create a method, which is annotated with<code>@subscribe_data_points</code> defined by the whole path to the <code>Datapoint</code> of interest.</p>
<p>In the method body, you can handle the information and send out MQTT messages. Notice that you get the data as a <code>JSON</code>-object and have to handle it accordingly.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@subscribe_data_points</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Vehicle.Cabin.Seat.Row1.Pos1.Position&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">on_vehicle_seat_change</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">resp_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fields</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;Vehicle.Cabin.Seat.Row1.Pos1.Position&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">int32_value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">req_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;position&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">resp_data</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Current Position of the Vehicle Seat is: </span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">req_data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish_mqtt_event</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;seatadjuster/currentPosition&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dumps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">req_data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">Exception</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">ex</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Unable to get Current Seat Position, Exception: </span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ex</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">resp_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#4e9a06">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;message&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">ex</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish_mqtt_event</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;seatadjuster/currentPosition&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dumps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">resp_data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h2 id="services">Services</h2>
<p>Services are used to communicate with other parts of the vehicle. Please read the basics about them <a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_model.md/#add-a-vehicle-service">here</a>.</p>
<p>The following few lines show you how to use the <code>MoveComponent</code>-method of the <code>SeatService</code> you have created:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000">location</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SeatLocation</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">row</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">index</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle_client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Cabin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SeatService</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">MoveComponent</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">location</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">BASE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">300</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>We have to use the <code>await</code> keyword here, since the service methods are co-routines. In order to know which seat to move, you have to pass a <code>SeatLocation</code> object as the first parameter. The second argument specifies the component to be moved. The possible components are defined in the proto-files. The last parameter to be passed into the method is the final position of the component.</p>
<h3 id="mqtt">MQTT</h3>
<p>Interaction with other Vehicle Apps or the cloud is enabled by using Mosquitto MQTT Broker. The MQTT broker runs inside a docker image, which is started automatically after starting the DevContainer.</p>
<p>In the <a href="/docs/getting-started/quickstart/#send-mqtt-messages-to-vehicle-app">general section</a> about the Vehicle App, you already tested sending MQTT messages to the app.
In the previous sections, you generally saw how to use <code>Vehicle Models</code>, <code>Datapoints</code> and <code>GRPC Services</code>. In this section, you will learn how to combine them with MQTT.
In order to receive the MQTT messages inside your app, <code>@subscribe_topic</code> annotation needs to be used with the specified topic. In the method, you can process the data or forward it to another method that handles processing and also provides a response.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@subscribe_topic</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;seatadjuster/setPosition/request&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">on_set_position_request_received</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;&#34;&#34;Handle set position request from GUI app from MQTT topic&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loads</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Set Position Request received: data=</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># noqa: E501</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_on_set_position_request_received</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;seatadjuster/setPosition/response&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>This method contains logic to execute requested operations or if that is not possible, respond with an error message. Another class, which you see next, is used to process the request.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_on_set_position_request_received</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">resp_topic</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87;font-weight:bold">None</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vehicle_speed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle_client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Speed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">vehicle_speed</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">processor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SetPositionRequestProcessor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle_client</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">processor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">resp_topic</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">error_msg</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;&#34;&#34;Not allowed to move seat because vehicle speed
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">            is </span><span style="color:#4e9a06">{</span><span style="color:#000">vehicle_speed</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> and not 0&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">warning</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">error_msg</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">resp_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">],</span>  <span style="color:#8f5902;font-style:italic"># type: ignore</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;message&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">error_msg</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish_mqtt_event</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">resp_topic</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dumps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">resp_data</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><p>The RequestProcessor class contains code responsible for processing the position request, including relevant MQTT communication.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SetPositionRequestProcessor</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;&#34;&#34;A class to process position requests.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vehicle_client</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Vehicle</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle_client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">vehicle_client</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">resp_topic</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">app</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">VehicleApp</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;&#34;&#34;Process the position request.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">resp_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__get_processed_response</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__publish_data_to_topic</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">resp_data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">resp_topic</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">app</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__get_processed_response</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">location</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SeatLocation</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">row</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">index</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">vehicle_client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Cabin</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SeatService</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">MoveComponent</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">location</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">BASE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;position&#34;</span><span style="color:#000;font-weight:bold">]</span>  <span style="color:#8f5902;font-style:italic"># type: ignore</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">resp_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">Exception</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">ex</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">resp_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>                <span style="color:#4e9a06">&#34;result&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;message&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__get_error_message_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ex</span><span style="color:#000;font-weight:bold">)},</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">resp_data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__publish_data_to_topic</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">resp_data</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">resp_topic</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">app</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">VehicleApp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">app</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish_mqtt_event</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">resp_topic</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">dumps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">resp_data</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">Exception</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">ex</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">logger</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__get_error_message_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ex</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__get_error_message_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ex</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#c00;font-weight:bold">Exception</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;Exception details: </span><span style="color:#4e9a06">{</span><span style="color:#000">ex</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h2 id="unittests">UnitTests</h2>
<p>Unit testing is an important part of the development, so let&rsquo;s have a look at how to do that. You can find some example tests in <code>test_set_position_request_processor.py</code>.
First, you have to import the relevant packages for unit testing and everything you need for your implementation:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">unittest</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">mock</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pytest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">sdv.vehicle_app</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">VehicleApp</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">vehicle_model.proto.seats_pb2</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">BASE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">SeatLocation</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">vehicle_model.SeatService</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">SeatService</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@pytest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">mark</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">asyncio</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_for_publish_to_topic</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#000">mock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">patch</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">object</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">VehicleApp</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;publish_mqtt_event&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">new_callable</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">mock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">AsyncMock</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">return_value</span><span style="color:#ce5c00;font-weight:bold">=-</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">VehicleApp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish_mqtt_event</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;sampleTopic&#34;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">get_sample_request_data</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">assert</span> <span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">get_sample_request_data</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;position&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">330</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;requestId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;123456789&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Looking at a test you notice the annotation <code>@pytest.mark.asyncio</code>. This is required if the test is defined as a co-routine. The next step is to create a mock from all the external dependencies. The method takes 4 arguments: first is the object to be mocked, second the method for which you want to modify the return value, third a callable and the last argument is the return value.
After creating the mock, you can test the method and check the response. Use asserts to make your test fail if the response does not match.</p>
<h2 id="see-the-results">See the results</h2>
<p>Once the implementation is done, it is time to run and debug the app.</p>
<h3 id="run-your-app">Run your App</h3>
<p>If you want to run the app together with a Dapr sidecar and use the Dapr middleware, you have to use the &ldquo;dapr run &hellip;&rdquo; command to start your app:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dapr run --app-id seatadjuster --app-protocol grpc --app-port <span style="color:#0000cf;font-weight:bold">50008</span> --config ./.dapr/config.yaml --components-path ./.dapr/components  python3 ./src/run.py
</span></span></code></pre></div><p>You already have seen this command and how to check if it is working in the <a href="/docs/getting-started/quickstart/#start-and-test-vehicle-app">general setup</a>.</p>
<p>2 parameters may be unclear in this command:</p>
<ul>
<li>the config file <code>config.yaml</code></li>
<li>the components-path</li>
</ul>
<p>For now, you just need to know that these parameters are needed to make everything work together.</p>
<p>The config.yaml has to be placed in the folder called <code>.dapr</code>and has the following content:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Yaml" data-lang="Yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dapr.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Configuration</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">config</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">tracing</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">samplingRate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">zipkin</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">     </span><span style="color:#204a87;font-weight:bold">endpointAddress</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">http://localhost:9411/api/v2/spans</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">features</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">   </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">proxy.grpc</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">     </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>An important part is the enabling of the GRPC proxy, to make the communication work.</p>
<p>Inside the <code>.dapr</code> folder you find another folder called <code>components</code>. There you only find one configuration file for the MQTT communication with the following content:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Yaml" data-lang="Yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dapr.io/v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Component</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">mqtt-pubsub</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pubsub.mqtt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">url</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;mqtt://localhost:1883&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">qos</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">retain</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;false&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cleanSession</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;false&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>If you want to know more about dapr and the configuration, please visit <a href="https://dapr.io">https://dapr.io</a></p>
<h3 id="debug-your-vehicle-app">Debug your Vehicle App</h3>
<p>In the <a href="/docs/getting-started/quickstart/#debug-vehicle-app">introduction about debugging</a>, you saw how to start a debugging session. In this section, you will learn what is happening in the background.</p>
<p>In order to be able to debug your code, you need to add some configs in Visual Studio Code. You find the files in the <code>.vscode</code> folder. The main entrypoint is the launch.json. All configurations are stored here.
Currently there is only one for the SeatAdjuster App.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span><span style="color:#4e9a06">&#34;configurations&#34;</span><span style="color:#a40000">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;python&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;justMyCode&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;request&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;launch&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;SeatAdjuster&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;program&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${workspaceFolder}/src/run.py&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;console&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;integratedTerminal&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;preLaunchTask&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dapr-SeatAdjuster-run&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;postDebugTask&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dapr-SeatAdjuster-stop&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;env&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;DAPR_GRPC_PORT&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;50001&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;SEATSERVICE_DAPR_APP_ID&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;seatservice&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;VEHICLEDATABROKER_DAPR_APP_ID&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;vehicledatabroker&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">]</span>
</span></span></code></pre></div><p>We specify which python-script to run using the <code>program</code> key. With the <code>preLaunchTask</code> and <code>postDebugTask</code> keys, you can also specify tasks to run before or after debugging. In this example, DAPR is set up to start the app before and stop it again after debugging. Below you can see the 2 tasks.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;label&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dapr-SeatAdjuster-run&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;appId&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;seatadjuster&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;appPort&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">50008</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;componentsPath&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;./.dapr/components&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;config&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;./.dapr/config.yaml&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;appProtocol&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;grpc&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dapr&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;--dapr-grpc-port&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;50001&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;--dapr-http-port&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;3500&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;label&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dapr-SeatAdjuster-stop&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;shell&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;command&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;dapr stop --app-id seatadjuster&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;presentation&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;close&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;reveal&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;never&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Lastly, the environment variables can also be specified.</p>
<p>You can adapt the JSON to your needs (e.g., change the ports, add new tasks) or even add a completely new configuration for another Vehicle App.</p>
<p>Once you are done, you have to switch to the debugging tab (sidebar on the left) and select your configuration using the dropdown on the top. You can now start the debug session by clicking the play button or <kbd>F5</kbd>. Debugging is now as simple as in every other IDE, just place your breakpoints and follow the flow of your Vehicle App.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li><a href="/tutorial_how_to_deploy_a_vehicle_app_with_helm.md">Walkthrough: Deploy a Python Vehicle App with Helm</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9d91984eb08cf20e39f25e171f5fb593">2.4 - Run Vehicle App Runtime Services</h1>
    <div class="lead">Learn how to run the  Vehicle App Runtime Services locally or in Kubernetes.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-b8a7e76bb8b53cf7ffc3a8f82f85ba4c">2.4.1 - Run runtime services in Kubernetes</h1>
    
	<p>Besides <a href="/docs/run_runtime_services_locally.md">local execution</a>, another way of running the runtime components is to deploy them as containers in a Kubernetes control plane (like K3D). To create a K3D instance, we provide Visual Studio Code <em>Tasks</em>, a feature of Visual Studio Code. Additional information on tasks can be found <a href="https://code.visualstudio.com/docs/editor/tasks">here</a>.</p>
<p><strong>Quick Start:</strong> Each step has a task that is defined in <em>.vscode/tasks.json</em>:</p>
<ul>
<li>Core tasks (dependent on each other in the given order):
<ul>
<li><code>K3D - Install prerequisites</code>: Install prerequisite components K3D, Helm, KubeCTL and Dapr without configuring them.</li>
<li><code>K3D - Configure control plane</code>: Creates a local container registry used by K3D as well as an K3D cluster with Dapr enabled.</li>
<li><code>K3D - Deploy runtime</code>: Deploys the runtime components (like Vehicle Data Broker, Seat Service, &hellip;) within the K3D cluster.</li>
<li><code>K3D - Build SeatAdjusterApp</code>: Builds the SeatAdjusterApp and pushes it to the local K3D registry.</li>
<li><code>K3D - Deploy SeatAdjusterApp</code>: Builds and deploys the SeatAdjusterApp via Helm to the K3D cluster.</li>
</ul>
</li>
</ul>
<p>Each task has the required dependencies defined. If you want to run the runtime in K3D, the task <code>K3D - Deploy SeatAdjusterApp</code> will create and configure everything. So it&rsquo;s enough to run that task.</p>
<ul>
<li>Optional helper tasks:
<ul>
<li><code>K3D - Deploy SeatAdjusterApp (without rebuild)</code>: Deploys the SeatAdjusterApp via Helm to the K3D cluster (without rebuilding it). That requires, that the task <code>K3D - Build SeatAdjusterApp</code> has been executed once before.</li>
<li><code>K3D - Install tooling</code>: Installs tooling for local debugging (K9s)</li>
<li><code>K3D - Uninstall runtime</code>: Uninstalls the runtime components from the K3D cluster (without deleting the cluster).</li>
<li><code>K3D - Reset control plane</code>: Deletes the K3D cluster and the registry with all deployed pods/services.</li>
</ul>
</li>
</ul>
<p>K3D is configured so that <em>Mosquitto</em> and the <em>Vehicle Data Broker</em> can be reached from outside the container over the ports <code>31883</code> (Mosquitto) and <code>30555</code>(Vehicle Data Broker). The test runner, that is running outside of the cluster, can interact with these services over those ports.</p>
<p>To check the status of your K3D instance (running pods, containers, logs, &hellip;) you can either use the <code>kubectl</code> utility or start <em>K9s</em> (after running the task <code>K3D - Install tooling</code> once) in a terminal window to have a UI for interacting with the cluster.</p>
<p><strong>Run as Bundle:</strong> To orchestrate these tasks, a task called <code>K3D - Deploy SeatAdjusterApp</code> is available. This task runs the other tasks in the correct order. You can run this task by clicking <code>F1</code> and choose <code>Tasks: Run task</code>, then select <code>K3D - Deploy SeatAdjusterApp</code>.</p>
<p><strong>Tasks Management:</strong> Visual Studio Code offers various other commands concerning tasks like Start/Terminate/Restart/&hellip; You can access them by pressing F1 and typing <code>task</code>. A list with available task commands will appear.</p>
<p><strong>Logging:</strong> Running tasks appear in the Terminals View of Visual Studio Code. From there, you can see the logs of each running task.</p>
<h2 id="uploading-files-to-persistentvolume">Uploading files to persistentVolume</h2>
<p>Some applications (e.g. FeederCAN) might make it necessary to load custom files from mounted volume. For that reason, persistentVolume is created in k3d cluster.
All the files that are located in <code>deploy/runtime/k3d/volume</code> will be uploaded to the k3d cluster dynamically. In order to mount files to the directory that is accessible by the application, please refer to the deployment configuration file: <a href="https://github.com/eclipse-velocitas/vehicle-app-python-template/blob/main/scripts/k3d/helm/templates/persistentVolume.yaml"><code>deploy/runtime/k3d/helm/templates/bash.yaml</code></a>.</p>
<p>Changes in <code>deploy/runtime/k3d/volume</code> are automatically reflected in PersistentVolume.</p>
<h3 id="uploading-custom-candump-file-to-feedercan">Uploading custom candump file to FeederCAN</h3>
<p>FeederCAN requires candump file. Pre-defined candump file is part of docker container release, however, if necessary, there is an option to upload the custom file by:</p>
<ol>
<li>Creating/updating candump file with with name <code>candump</code> in <code>deploy/runtime/k3d/volume</code></li>
<li>Recreating the feedercan pod: <code>kubectl delete pods -l app=feedercan</code></li>
</ol>
<p>More information about FeederCan can be found <a href="https://github.com/eclipse/kuksa.val/tree/master/kuksa_feeders">here</a></p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li><a href="/docs/setup_and_explore_development_environment.md">Setup and Explore Development Enviroment</a></li>
<li><a href="/docs/run_runtime_services_locally.md">Deploy runtime services locally</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c17c8d2574e5368e139743922d9a9fc3">2.4.2 - Run runtime services locally</h1>
    
	<h2 id="using-tasks-in-visual-studio-code">Using tasks in Visual Studio Code</h2>
<p><strong>Overview:</strong> If you are developing in Visual Studio Code, the runtime components (like <em>Vehicle Data Broker</em> or <em>Vehicle Services</em>) are available for local execution as <em>Tasks</em>, a feature of the Visual Studio Code. Additional information on tasks can be found <a href="https://code.visualstudio.com/docs/editor/tasks">here</a>.</p>
<p><strong>Quick Start:</strong> Each component has a task that is defined in <em>.vscode/tasks.json</em>:</p>
<ul>
<li>Dapr (<code>Local - Ensure Dapr</code>): installs Dapr CLI and initializes Dapr if required</li>
<li>Mosquitto (<code>Local - Mosquitto</code>): runs <em>Mosquitto</em> as a container (<code>docker run</code>)</li>
<li>Vehicle Data Broker (<code>Local - VehicleDataBroker</code>): downloads and runs <em>Vehicle Data Broker</em></li>
<li>(Optional) Seat Service (<code>Local - SeatService</code>): downloads and runs <em>Seat Service</em>, an example <code>Vehicle Service</code></li>
<li>(Optional) Feeder Can (<code>Local - FeederCan</code>): downloads and runs <em>FeederCAN</em></li>
</ul>
<p><strong>Run as Bundle:</strong> To orchestrate these tasks, a task called <code>Start Vehicle App runtime</code> is available. This task runs the other tasks in the correct order. You can run this task by clicking <code>F1</code> and choose <code>Tasks: Run task</code>, then select <code>Start Vehicle App runtime</code>.</p>
<p><strong>Tasks Management:</strong> Visual Studio Code offers various other commands concerning tasks like Start/Terminate/Restart/&hellip; You can access them by pressing F1 and typing <code>task</code>. A list with available task commands will appear.</p>
<p><strong>Logging:</strong> Running tasks appear in the Terminals View of Visual Studio Code. From there, you can see the logs of each running task.</p>
<p><strong>Scripting:</strong> The tasks itself are executing scripts that are located in <code>.vscode/scripts</code>. These scripts download the specified version of the runtime components and execute them along with Dapr. The same mechanism can be used to register additional services or prerequisites by adding new task definitions in the <code>tasks.json</code> file.</p>
<h2 id="change-version-of-runtime-services">Change version of runtime services</h2>
<p>The version for the runtime services is defined in the file <a href="https://github.com/eclipse-velocitas/vehicle-app-python-template/blob/main/prerequisite_settings.json"><code>./prerequisite_settings.json</code></a>. If you want to update the version, change it within the file and re-run the runtime services by restarting the tasks or the script.</p>
<h2 id="using-vehicle-databroker-cli">Using Vehicle Databroker CLI</h2>
<p>A CLI tool is provided for the interact with a running instance of the Vehicle Data Broker. It can be started by running the task <code>run-vehicledatabroker-cli</code>(by pressing <em>F1</em>, type <em>Run Task</em> followed by <code>run-vehicledatabroker-cli</code>). The <em>Vehicle Data Broker</em> needs to be running for you to be able to use the tool.</p>
<h2 id="integrating-a-new-service-into-visual-studio-code-task">Integrating a new service into Visual Studio Code Task</h2>
<p>Integration of a new service can be done by duplicating one of the existing tasks.</p>
<ul>
<li>Create a new script based on template script <code>.vscode/scripts/run-vehicledatabroker.sh</code></li>
<li>In <code>.vscode/tasks.json</code>, duplicate section from task <code>run-vehicledatabroker</code></li>
<li>Correct names in a new code block</li>
<li><strong>Disclaimer:</strong> <code>Problem Matcher</code> defined in <code>tasks.json</code> is a feature of the Visual Studio Code Task, to ensure that the process runs in background</li>
<li>Run task using <code>[F1 -&gt; Tasks: Run Task -&gt; &lt;Your new task name&gt;]</code></li>
<li>Task should be visible in Terminal section of Visual Studio Code</li>
</ul>
<h3 id="task-codeblock-helper">Task CodeBlock helper</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;label&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;__CHANGEIT: Task name__&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;shell&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;command&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;./.vscode/scripts/&lt;__CHANGEIT: Script Name.sh__&gt; --task&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;group&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;none&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;presentation&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;reveal&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;always&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;panel&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;dedicated&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;isBackground&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#204a87">true</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;problemMatcher&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;pattern&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#4e9a06">&#34;regexp&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;.&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#4e9a06">&#34;file&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#4e9a06">&#34;location&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#4e9a06">&#34;message&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;background&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;activeOnStart&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#204a87">true</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;beginsPattern&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;^&lt;__CHANGEIT: Regex log from your app, decision to send process in background__&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;endsPattern&#34;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;.&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">},</span>
</span></span></code></pre></div><h2 id="troubleshooting">Troubleshooting</h2>
<p><strong>Problem description:</strong> When integrating new services into an existing dev environment, it is highly recommended to use the Visual Studio Code Task Feature.
A new service can be easily started by calling it from bash script, however restarting the same service might lead to port conflicts (GRPC Port or APP port). That can be easily avoided by using the Visual Studio Code Task Feature.</p>
<h3 id="codespaces">Codespaces</h3>
<p>If you are using Codespaces, remember that you are working on a remote agent. That&rsquo;s why it could happen that the tasks are already running in the background. If that&rsquo;s the case a new start of the tasks will fail, since the ports are already in use. In the Dapr-tab of the sidebar you can check if there are already tasks running. Another possibility to check if the processes are already running, is to check which ports are already open. Check the Ports-tab to view all open ports (if not already open, hit <code>F1</code> and enter <code>View: Toggle Ports</code>).</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li><a href="/docs/setup_and_explore_development_environment.md">Setup and Explore Development Enviroment</a></li>
<li><a href="/docs/run_runtime_services_kubernetes.md">Deploy runtime services in Kubernetes mode</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-92434ff59ee018c09ee5056e41a30ded">2.5 - Vehicle App Integration Testing</h1>
    <div class="lead">Learn how to test that a Vehicle App together with the Vehicle Data Broker and potentially other dependant Vehicle Services or Vehicle Apps runs as expected.</div>
	<p>To be sure that a newly created <em>Vehicle App</em> will run together with the <em>Vehicle Data Broker</em> and potentially other dependant <em>Vehicle Services</em> or <em>Vehicle Apps</em>, it&rsquo;s essential to write integration tests along with developing the app.</p>
<p>To execute an integration test, the dependant components need to be running and accessible from the test runner. This guide will describe how integration tests can be written and integrated in the CI pipeline so that they are executed automatically when building the application.</p>
<h2 id="quickstart">Quickstart</h2>
<ol>
<li>Make sure that the local execution of runtime components is working and started.</li>
<li>Start the application (Debugger or run as task).</li>
<li>Extend the test file <code>/test/integration_test.py</code> or create a new test file.</li>
<li>Run/debug tests with the Visual Studio Code Test runner.</li>
</ol>
<h2 id="runtime-components">Runtime components</h2>
<p>To be able to test the <em>Vehicle App</em> in an integrated way, the following components should be running:</p>
<ul>
<li>Dapr</li>
<li>Mosquitto</li>
<li>Vehicle Data Broker</li>
<li>Vehicle Services</li>
</ul>
<p>We distinguish between two environments for executing the <em>Vehicle App</em> and the runtime components:</p>
<ul>
<li><strong>Local execution</strong>: components are running locally in the development environment</li>
<li><strong>Kubernetes execution</strong>: components (and application) are deployed and running in a Kubernetes control plane (e.g., K3D)</li>
</ul>
<h3 id="local-execution">Local Execution</h3>
<p>First, make sure that the runtime services are configured and running like described <a href="/docs/run_runtime_services_locally.md">here</a>.</p>
<p>The application itself can be executed by using a Visual Studio Launch Config (by pressing <kbd>F5</kbd>) or by executing the task <code>SeatAdjuster</code>.</p>
<p>When the runtime services and the application are running, integration tests can be executed locally.</p>
<h3 id="kubernetes-execution-k3d">Kubernetes execution (K3D)</h3>
<p>If you want to execute the integration tests in Kubernetes mode, make sure that K3D is up and running according to the <a href="/docs/run_runtime_services_kubernetes.md">documentation</a>. To ensure that the tests connect to the containers, please execute the following steps in new bash terminal:</p>
<ul>
<li><code>export MQTT_PORT=31883</code></li>
<li><code>export VDB_PORT=30555</code></li>
<li><code>pytest</code></li>
</ul>
<h2 id="writing-test-cases">Writing Test Cases</h2>
<p>To write an integration test, you should check the sample that comes with the template (<a href="https://github.com/eclipse-velocitas/vehicle-app-python-template/blob/main/test/integration_test.py"><code>/test/integration_test.py</code></a>). To support interacting with the MQTT broker and the Vehicle Data Broker (to get and set values for DataPoints), there are two classes present in Python SDK that will help:</p>
<ul>
<li>
<p><code>MqttClient</code>: this class provides methods for interacting with the MQTT broker. Currently, the following methods are available:</p>
<ul>
<li>
<p><code>publish_and_wait_for_response</code>: publishes the specified payload to the given request topic and waits (till timeout) for a message to the response topic. The payload of the first message that arrives in the response topic will be returned. If the timeout expires before, an empty string (&quot;&quot;) is returned.</p>
</li>
<li>
<p><code>publish_and_wait_for_property</code>: publishes the specified payload to the given request topic and waits (till timeout) until the given property value is found in an incoming message to the response topic. The <code>path</code> describes the property location within the response message, the <code>value</code> the property value to look for.</p>
<p><em>Example:</em></p>
<pre tabindex="0"><code>{
    &#34;status&#34;: &#34;success&#34;,
    &#34;result&#34;: {
        &#34;responsecode&#34;: 10
    }
}
</code></pre><p>If the <code>responsecode</code> property should be checked for the value <code>10</code>, the path would be <code>[&quot;result&quot;, &quot;responsecode]</code>, property value would be <code>10</code>. When the requested value has been found in a response message, the payload of that message will be returned. If the timeout expires before receiving a matching message, an empty string (&quot;&quot;) is returned.</p>
</li>
</ul>
<p>This class can be initialized with a given port. If no port is specified, the environment variable <code>MQTT_PORT</code> will be checked. If this is not possible either, the default value of <code>1883</code> will be used. <strong>It&rsquo;s recommended to specify no port when initializing that class as it will locally use the default port <code>1883</code> and in CI the port set by the environment variable <code>MQTT_PORT</code>. This will prevent a check-in in the wrong port from local development.</strong></p>
</li>
<li>
<p><code>IntTestHelper</code>: this class provides functionality to interact with the <em>Vehicle Data Broker</em>.</p>
<ul>
<li><code>register_dapoint</code>: registers a new datapoint with given name and type</li>
<li><code>set_..._datapoint</code>: set the given value for the datapoint with the given name (with given type). If the datapoint does not exist, it will be registered.</li>
</ul>
<p>This class can be initialized with a given port. If no port is specified, the environment variable <code>VDB_PORT</code> will be checked. If this is not possible either, the default value of <code>55555</code> will be used. <strong>It&rsquo;s recommended to specify no port when initializing that class as it will locally use the default port <code>55555</code> and in CI the port set by the environment variable <code>VDB_PORT</code> which is set. This will prevent a check-in in the wrong port from local development.</strong></p>
</li>
</ul>
<blockquote>
<p><strong>Please make sure that you don&rsquo;t check in the test classes with using local ports because then the execution in the CI workflow will fail (as the CI workflow uses Kubernetes execution for running integration tests).</strong></p>
</blockquote>
<h2 id="running-tests-locally">Running Tests locally</h2>
<p>Once tests are developed, they can be executed against the running runtime components, either to the <strong><em>local runtime</em></strong><code>(**Remark Bjoern:** Should we talk here - in analogy to dapr-terminology - of &quot;self-hosted&quot;. Because &quot;local&quot; is used already for distinguishing between execution on local machine vs. CI pripline)</code> or in Kubernetes mode, by using the test runner in Visual Studio Code. The switch to run against the local components or the Kubernetes components is specified by the port. Local ports for <em>Mosquitto</em> and <em>Vehicle Data Broker</em> are <code>1883</code>/<code>55555</code>. In Kubernetes mode, the ports would be the locally exposed ports <code>31883</code>/<code>30555</code>. If using the Kubernetes ports, the tests will be executed against the runtime components/application that run in containers within the Kubernetes cluster.</p>
<h2 id="running-tests-in-ci-pipeline">Running Tests in CI pipeline</h2>
<p>The tests will be discovered and executed automatically in the <a href="https://github.com/eclipse-velocitas/vehicle-app-python-template/blob/main/.github/workflows/ci.yml">CI pipeline</a>. The job <code>Run Integration Tests</code> contains all steps to setup and execute tests in Kubernetes mode. The results are published as test results to the workflow.</p>
<h1 id="common-tasks">Common Tasks</h1>
<h2 id="run-test-in-local-mode">Run test in local mode</h2>
<ol>
<li>Make sure that the <a href="/docs/run_runtime_services_kubernetes.md">tasks for the runtime components</a> are running (by checking the terminal view).</li>
<li>Make sure that your application is running (via Debugger or task).</li>
<li>Make sure that you are using the right ports for local execution of runtime components.</li>
<li>Run tests from the test runner.</li>
</ol>
<h2 id="run-tests-in-kubernetes-mode">Run tests in Kubernetes mode</h2>
<ol>
<li>Make sure that K3D is up and running (by calling the scripts in the <code>scripts/k3d</code> folder, 01 - 04).</li>
<li>Make sure that the tests are using the right ports for Kubernetes execution.</li>
<li>Run tests from the test runner.</li>
</ol>
<h2 id="update-application-when-running-in-kubernetes-mode">Update application when running in Kubernetes mode</h2>
<ol>
<li>Re-run the script <code>/scripts/k3d/04_deploy-apps.sh</code> that rebuilds and deploys the application to K3D.</li>
<li>Re-run tests from the test runner.</li>
</ol>
<h1 id="troubleshooting">Troubleshooting</h1>
<h2 id="check-if-the-services-are-registered-correctly-in-dapr">Check if the services are registered correctly in Dapr</h2>
<ul>
<li>When running in local mode, call <code>dapr dashboard</code> in a terminal and open the given URL to see the Dapr dashboard in the browser.</li>
<li>When running in Kubernetes mode, call <code>dapr dashboard -k</code> in a terminal and open the given URL to see the Dapr dashboard in the browser.</li>
</ul>
<h2 id="troubleshoot-inttesthelper">Troubleshoot IntTestHelper</h2>
<ul>
<li>Make sure that the <em>Vehicle Data Broker</em> is up and running by checking the task log.</li>
<li>Make sure that you are using the right ports for local/Kubernetes execution.</li>
<li>Make sure that you installed the correct version of the SDK (<em>SDV</em>-package).</li>
</ul>
<h2 id="troubleshoot-mosquitto-mqtt-broker">Troubleshoot Mosquitto (MQTT Broker)</h2>
<ul>
<li>Make sure that the <em>Mosquitto</em> up and running by checking the task log.</li>
<li>Make sure that you are using the right ports for local/Kubernetes execution.</li>
<li>Use VsMqtt extension to connect to MQTT broker (<code>localhost:1883</code> (local) or <code>localhost:31883</code> (Kubernetes)) to monitor topics in MQTT broker.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f3e319d0b9b198af5c39068a78e57d4b">2.6 - Vehicle App Deployment with Helm</h1>
    <div class="lead">Learn how to prepare a Helm chart for the deployment of a Python Vehicle App.</div>
	<p>This tutorial will show you how to:</p>
<ul>
<li>Prepare a Helm chart</li>
<li>Deploy your Python Vehicle App to local K3D</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a> with the <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">Python extension</a> installed. For information on how to install extensions on Visual Studio Code, see <a href="https://code.visualstudio.com/docs/editor/extension-gallery">VS Code Extension Marketplace</a>.</li>
<li>Completed the tutorial <a href="/docs/python-sdk/tutorial_how_to_create_a_vehicle_app.md">How to create a vehicle app</a></li>
</ul>
<h2 id="prepare-a-helm-chart">Prepare a Helm chart</h2>
<p>If the Vehicle App has been created from the Python template repository, a sample Helm chart is already available under <code>deploy/SeatAdjusterApp</code>.</p>
<p>This will be adapted to deploy a new vehicle app, which is called <code>my_vehicle_app</code> for this walkthrough.</p>
<ol>
<li>
<p>Start Visual Studio Code and open the previously created Vehicle App repository.</p>
</li>
<li>
<p>Create a new folder <code>my_vehicle_app</code> under <code>deploy</code></p>
</li>
<li>
<p>Copy all files from the <code>deploy/SeatAdjusterApp</code> folder to the new folder <code>deploy/my_vehicle_app</code>.</p>
</li>
<li>
<p>Rename the file <code>deploy/my_vehicle_app/helm/templates/seatadjuster.yaml</code> to <code>deploy/my_vehicle_app/helm/templates/my_vehicle_app.yaml</code></p>
</li>
<li>
<p>Open <code>deploy/my_vehicle_app/helm/Chart.yaml</code> and change the name of the chart to <code>my_vehicle_app</code> and provide a meaningful description.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my_vehicle_app</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Short description for my_vehicle_app</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># A chart can be either an &#39;application&#39; or a &#39;library&#39; chart.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># Application charts are a collection of templates that can be packaged into versioned archives</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># to be deployed.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># Library charts provide useful utilities or functions for the chart developer. They&#39;re included as</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># a dependency of application charts to inject those utilities and functions into the rendering</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># pipeline. Library charts do not define any templates and cannot be deployed as a result.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">application</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># This is the chart version. This version number should be incremented each time you make changes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># to the chart and its templates, including the app version.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># Versions are expected to follow Semantic Versioning (https://semver.org/)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0.1.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># This is the version number of the application being deployed. This version number should be</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># incremented each time you make changes to the application. Versions are not expected to</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># follow Semantic Versioning. They should reflect the version the application is using.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">appVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1.16.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
<li>
<p>Open <code>deploy/my_vehicle_app/helm/values.yaml</code> and change <code>name</code>, <code>repository</code> and <code>daprAppid</code> to <code>my_vehicle_app</code>. Rename the root node from <code>imageSeatAdjusterApp</code> to <code>imageMyVehicleApp</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">imageMyVehicleApp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my_vehicle_app</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">repository</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">local/my_vehicle_app</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pullPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Always</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Overrides the image tag whose default is the chart appVersion.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">tag</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;#SuccessfulExecutionOfReleaseWorkflowUpdatesThisValueToReleaseVersionWithoutV#&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">daprAppid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my_vehicle_app</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">daprPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">50008</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">nameOverride</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fullnameOverride</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
<li>
<p>Open <code>deploy/my_vehicle_app/helm/templates/my_vehicle_app.yaml</code> and replace <code>imageSeatAdjusterApp</code> with <code>imageMyVehicleApp</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">apps/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">.Values.imageMyVehicleApp.name}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">.Values.imageMyVehicleApp.name}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">.Values.imageMyVehicleApp.name}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dapr.io/enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dapr.io/app-id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{{.Values.imageMyVehicleApp.daprAppid}}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dapr.io/app-port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{{.Values.imageMyVehicleApp.daprPort}}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dapr.io/log-level</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;debug&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dapr.io/config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;config&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dapr.io/app-protocol</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;grpc&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">.Values.imageMyVehicleApp.name}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>{{- <span style="color:#000">include &#34;helm.selectorLabels&#34; . | nindent 8 }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#000">.Values.imageMyVehicleApp.name}}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{{ .Values.imageMyVehicleApp.repository }}:{{ .Values.imageMyVehicleApp.tag | default .Chart.AppVersion }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">imagePullPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">.Values.imageMyVehicleApp.pullPolicy }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li>
<li>
<p>Rename <code>deploy/my_vehicle_app/deploy_seat-adjuster-app.sh</code> to <code>deploy/my_vehicle_app/deploy-my-vehicle-app.sh</code> and replace all occurences of <code>SeatAdjusterApp</code> with <code>MyVehicleApp</code> and <code>seatservice</code> with <code>my-vehicle-app</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000">WORKING_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[</span> -f <span style="color:#4e9a06">&#34;./../../github_token.txt&#34;</span> <span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;github_token,src=github_token.txt&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;github_token&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[</span> -n <span style="color:#4e9a06">&#34;</span><span style="color:#000">$HTTP_PROXY</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;Building image with proxy configuration&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">cd</span> <span style="color:#000">$WORKING_DIR</span>/../../
</span></span><span style="display:flex;"><span>    <span style="color:#000">DOCKER_BUILDKIT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> docker build <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -f src/MyVehicleApp/Dockerfile <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --progress<span style="color:#ce5c00;font-weight:bold">=</span>plain --secret <span style="color:#000">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$GITHUB_TOKEN</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -t localhost:12345/my-vehicle-app:local <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --build-arg <span style="color:#000">HTTP_PROXY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$HTTP_PROXY</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --build-arg <span style="color:#000">HTTPS_PROXY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$HTTPS_PROXY</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --build-arg <span style="color:#000">FTP_PROXY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$FTP_PROXY</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --build-arg <span style="color:#000">ALL_PROXY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$ALL_PROXY</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --build-arg <span style="color:#000">NO_PROXY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$NO_PROXY</span><span style="color:#4e9a06">&#34;</span> . --no-cache
</span></span><span style="display:flex;"><span>    docker push localhost:12345/my-vehicle-app:local
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">cd</span> <span style="color:#000">$WORKING_DIR</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;Building image without proxy configuration&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Build, push vehicleapi image - NO PROXY</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">cd</span> <span style="color:#000">$WORKING_DIR</span>/../../
</span></span><span style="display:flex;"><span>    <span style="color:#000">DOCKER_BUILDKIT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> docker build -f src/MyVehicleApp/Dockerfile --progress<span style="color:#ce5c00;font-weight:bold">=</span>plain --secret <span style="color:#000">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$GITHUB_TOKEN</span> -t localhost:12345/my-vehicle-app:local . --no-cache
</span></span><span style="display:flex;"><span>    docker push localhost:12345/my-vehicle-app:local
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">cd</span> <span style="color:#000">$WORKING_DIR</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>helm uninstall vapp-chart --wait
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Deploy in Kubernetes</span>
</span></span><span style="display:flex;"><span>helm install vapp-chart ./helm --values ../runtime/k3d/values.yml --wait --timeout 60s --debug
</span></span></code></pre></div></li>
</ol>
<p>At this point, the Helm chart and the sh-script are ready to use and folder structure under <code>deploy/my_vehicle_app</code> should look like this:</p>
<pre tabindex="0"><code>deploy
├── my_vehicle_app
│   └── helm
│       └── templates
│           └── _helpers.tpl
│           └── my_vehicle_app.yaml
│────────── .helmignore
│────────── Chart.yaml
│────────── values.yaml
└────── deploy-my-vehicle-app.sh
</code></pre><h2 id="deploy-your-python-vehicle-app-to-local-k3d">Deploy your Python Vehicle App to local K3D</h2>
<h3 id="prerequisites-1">Prerequisites</h3>
<ul>
<li>A local K3D installation must be available. For how to setup K3D, check out this <a href="/run_runtime_services_kubernetes.md">tutorial</a>.</li>
</ul>
<p>After the Helm chart has been prepared, you can deploy it to local K3D.</p>
<ol>
<li>Execute the script <code>deploy/my_vehicle_app/deploy-my-vehicle-app.sh</code>.</li>
</ol>
<p>This script builds the local source code of the application into a container, pushes that container to the local cluster registry and deploys the app via a helm chart to the K3D cluster. Rerun this script after you have changed the source code of your application to re-deploy with the latest changes.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li><a href="/docs/velocitas/docs/vehicle_app_releases.md">Release your Vehicle App</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8df6ea6904416b571ff9bc73afb50933">3 - Reference</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-3ff87169322881c55b35cb588a8807ea">3.1 - Vehicle Abstraction Layer (VAL)</h1>
    
	<h2 id="introduction">Introduction</h2>
<p>The Vehicle Abstraction Layer (VAL) is a reference implementation of an abstraction layer that allows Vehicle applications
to interact with signals and services in the vehicle.
It currently consists of a data broker, a CAN feeder and a set of example services.
More elaborate or completely differing implementations are the target of particular derived projects.</p>
<h2 id="architecture">Architecture</h2>
<p>The image below shows the main components of the Vehicle Abstraction Layer (VAL) and its relation to the <a href="/docs/development-model.md">Velocitas Development Model</a>.</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/reference/val/val_architecture_overview_hue12a1c2ecc85cf3ee9799265a093472d_127432_800x0_resize_catmullrom_3.png" width="800" height="614">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Overview of the vehicle abstraction layer architecture
</p>
	</figcaption>
	
</figure>

<h3 id="vehicle-data-broker">Vehicle Data Broker</h3>
<p>The <a href="https://github.com/eclipse/kuksa.val/tree/master/kuksa_databroker">Vehicle Data Broker</a> is a gRPC service acting as a broker of vehicle data / data points / signals.
It provides central access to vehicle data points arranged in a - preferably standardized - vehicle data model like the <a href="https://covesa.github.io/vehicle_signal_specification/">COVESA Vehicle Signal Specification (VSS)</a> or others.
It is implemented in Rust, can run in a container and provides services to get datapoints, update datapoints and for subscribing to datapoints.
Filter- and rule-based subscriptions of datapoints can be used to reduce the number of updates sent to the subscriber.</p>
<h3 id="data-feeders">Data Feeders</h3>
<p>Conceptually, a data feeder is a provider of a certain set of data points to the data broker.
The source of the contents of the data points provided is specific to the respective feeder.</p>
<p>As of today, the Vehicle Abstraction Layer contains a <a href="https://github.com/eclipse/kuksa.val/tree/master/kuksa_feeders">generic CAN feeder</a> implemented in Python,
which reads data from a CAN bus based on specifications in a e.g., CAN network description file.
The feeder then uses a mapping file and data point metadata to convert the source data to data points and injects them into the Vehicle Data Broker using the Vehicle Data Broker gRPC interface.
The feeder automatically reconnects to the data broker in the event that the connection is lost.</p>
<h3 id="vehicle-services">Vehicle Services</h3>
<p>A vehicle service offers a gRPC interface for interacting with underlying services.
It can provide service interfaces to control actuators or to trigger (complex) actions, or provide interfaces to get data.
It communicates with the Hardware Abstraction to execute the underlying services, but may also interact with the Vehicle Data Broker.</p>
<p>As of today, the Vehicle Abstraction Layer contains one <a href="https://github.com/eclipse/kuksa.val.services/tree/v0.1.0/seat_service">example service to control a seat</a>.
It is implemented in C++ and uses the <a href="https://github.com/eclipse/kuksa.val/tree/master/kuksa_feeders">CAN feeder</a> to control a seat in the vehicle.</p>
<h3 id="hardware-abstraction">Hardware Abstraction</h3>
<p>Data feeders rely on hardware abstraction. Hardware abstraction project/platform specific.
The reference implementation relies on [SocketCAN]<a href="https://github.com/eclipse/kuksa.val/tree/master/kuksa_feeders">(https://github.com/eclipse/kuksa.val/tree/master/kuksa_feeders</a>) and
<a href="https://github.com/eclipse/kuksa.val/tree/master/kuksa_feeders">vxcan</a>.
The hardware abstraction may offer replaying (e.g., CAN) data from a file (can dump file) when the respective data source (e.g., CAN) is not available.</p>
<h2 id="information-flow">Information Flow</h2>
<p>The vehicle abstraction layer offers an information flow between vehicle networks and vehicle services.
The data that can flow is ultimately limited to the data available through the Hardware Abstraction, which is platform/project-specific.
Which data can actually be sent or consumed is controlled by <a href="https://github.com/eclipse/kuksa.val/blob/master/kuksa_feeders/dbc2val/Model3CAN.dbc">DBC</a>
and <a href="https://github.com/eclipse/kuksa.val/blob/master/kuksa_feeders/dbc2val/mapping.yml">Mapping</a> files.
Services (like the <a href="https://github.com/eclipse/kuksa.val.services/tree/v0.1.0/seat_service">seat service</a>) define which CAN signals they listen to and which CAN signals they send themselves, see <a href="https://github.com/eclipse/kuksa.val.services/blob/v0.1.0/seat_service/src/lib/seat_adjuster/seat_controller/README.md">documentation</a>
The Vehicle Data Broker offers read/write/subscribe using MQTT. The VSS signals supported are currently limited by a <a href="https://github.com/eclipse/kuksa.val/blob/master/kuksa_databroker/databroker/src/main.rs">hard coded list</a>.</p>
<p>Additional information on how data privacy is managed can be found in the <a href="https://github.com/eclipse/kuksa.val.services/tree/v0.1.0#privacy-customer-information">Vehicle Abstraction Layer repository</a></p>
<h3 id="data-flow-when-a-vehicle-application-uses-the-vehicle-data-broker">Data flow when a Vehicle Application uses the Vehicle Data Broker.</h3>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/reference/val/dataflow_broker_hu042a46cff9fdb3ae953ce2b4baa695f0_25200_800x0_resize_catmullrom_3.png" width="800" height="122">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Architectural representation of the vehicle data broker data flow
</p>
	</figcaption>
	
</figure>

<h3 id="data-flow-when-a-vehicle-application-uses-a-vehicle-service">Data flow when a Vehicle Application uses a Vehicle Service.</h3>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/reference/val/dataflow_service_hu2c631cbebd9c8512318cb5903df1828b_24831_800x0_resize_catmullrom_3.png" width="800" height="130">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Architectural representation of the vehicle service data flow
</p>
	</figcaption>
	
</figure>

<h2 id="source-code">Source Code</h2>
<p>Source code and build instructions are available in the <a href="https://github.com/eclipse/kuksa.val">kuksa.val repository</a>.</p>
<h2 id="guidelines">Guidelines</h2>
<ul>
<li>Please see the <a href="vehicle_service.md">vehicle service guidelines</a> for information on how to implement a Vehicle Service.</li>
<li>Please see the <a href="interface_guideline.md">interface guideline</a> for best practices on how to specify a gRPC interface.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9a5bb1344781821cfb0c525d922e645e">3.1.1 - Interface Design Guideline</h1>
    
	<h2 id="grpc-interface-style-guide">GRPC Interface Style Guide</h2>
<p>This document provides a style guide for .proto files. By following these conventions, you&rsquo;ll make your protocol buffer message definitions and their corresponding classes consistent and easy to read.
Unless otherwise indicated, this style guide is based on the style guide from <a href="https://developers.google.com/protocol-buffers/docs/style">google protocol-buffers style</a> under Apache 2.0 License &amp; Creative Commons Attribution 4.0 License.</p>
<p>Note that protocol buffer style can evolve over time, so it is likely that you will see .proto files written in different conventions or styles. Please respect the existing style when you modify these files. Consistency is key. However, it is best to adopt the current best style when you are creating a new .proto file.</p>
<h3 id="standard-file-formatting">Standard file formatting</h3>
<ul>
<li>Keep the line length to 80 characters.</li>
<li>Use an indent of 2 spaces.</li>
<li>Prefer the use of double quotes for strings.</li>
</ul>
<h3 id="file-structure">File structure</h3>
<p>Files should be named lower_snake_case.proto</p>
<p>All files should be ordered in the following manner:</p>
<ul>
<li>License header</li>
<li>File overview</li>
<li>Syntax</li>
<li>Package</li>
<li>Imports (sorted)</li>
<li>File options</li>
<li>Everything else</li>
</ul>
<h3 id="directory-structure">Directory Structure</h3>
<p>Files should be stored in a directory structure that matches their package sub-names. All files
in a given directory should be in the same package.
Below is an example based on the <a href="https://github.com/eclipse/kuksa.val/tree/master/kuksa_databroker/proto">proto files</a> in the kuksa.val repository.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>|   proto/
</span></span><span style="display:flex;"><span>|   └── sdv
</span></span><span style="display:flex;"><span>|       └── databroker
</span></span><span style="display:flex;"><span>|           └── v1                  // package sdv.databroker.broker.v1
</span></span><span style="display:flex;"><span>|               ├── broker.proto    // service Broker in sdv.databroker.broker.v1
</span></span><span style="display:flex;"><span>|               ├── collector.proto // service Collector in sdv.databroker.broker.v1
</span></span><span style="display:flex;"><span>|               └── types.proto     // type definition and import of  in sdv.databroker.broker.v1
</span></span></code></pre></div><p>The proposed structure shown above is adapted from <a href="https://raw.githubusercontent.com/uber/prototool/dev/style/README.md">Uber Protobuf Style Guide V2</a> under MIT License.</p>
<h3 id="packages">Packages</h3>
<p>Package names should be in lowercase. Package names should have unique names based on the project name, and possibly based on the path of the file containing the protocol buffer type definitions.</p>
<h3 id="message-and-field-names">Message and field names</h3>
<p>Use PascalCase (CamelCase with an initial capital) for message names – for example, SongServerRequest. Use underscore_separated_names for field names (including oneof field and extension names) – for example, song_name.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>message SongServerRequest {
</span></span><span style="display:flex;"><span>   optional string song_name = 1;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Using this naming convention for field names gives you accessors like the following:</p>
<p>C++:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">string</span><span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">song_name</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">set_song_name</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">string</span><span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>If your field name contains a number, the number should appear after the letter instead of after the underscore. For example, use song_name1 instead of song_name_1
Repeated fields</p>
<p>Use pluralized names for repeated fields.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-proto" data-lang="proto"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">repeated</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#000">keys</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">repeated</span> <span style="color:#000">MyMessage</span> <span style="color:#000">accounts</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">17</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span></span></span></code></pre></div><h3 id="enums">Enums</h3>
<p>Use PascalCase (with an initial capital) for enum type names and CAPITALS_WITH_UNDERSCORES for value names:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">enum</span> <span style="color:#000">FooBar</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#000">FOO_BAR_UNSPECIFIED</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#000">FOO_BAR_FIRST_VALUE</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#000">FOO_BAR_SECOND_VALUE</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Each enum value should end with a semicolon, not a comma. The zero value enum should have the suffix UNSPECIFIED.</p>
<p>###Services</p>
<p>If your .proto defines an RPC service, you should use PascalCase (with an initial capital) for both the service name and any RPC method names:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-proto" data-lang="proto"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">service</span> <span style="color:#000">FooService</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>   <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">GetSomething</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">GetSomethingRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">GetSomethingResponse</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span>   <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">ListSomething</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ListSomethingRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">ListSomethingResponse</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></span></span></code></pre></div><h3 id="grpc-interface-versioning">GRPC Interface Versioning</h3>
<p>All API interfaces must provide a major version number, which is encoded at the end of the protobuf package.
If an API introduces a breaking change, such as removing or renaming a field, it must increment its API version number to ensure that existing user code does not suddenly break.
Note: The use of the term &ldquo;major version number&rdquo; above is taken from semantic versioning. However, unlike in traditional semantic versioning, APIs must not expose minor or patch version numbers.
For example, APIs use v1, not v1.0, v1.1, or v1.4.2. From a user&rsquo;s perspective, minor versions are updated in place, and users receive new functionality without migration.</p>
<p>A new major version of an API must not depend on a previous major version of the same API. An API may depend on other APIs, with an expectation that the caller understands the dependency and stability risk associated with those APIs. In this scenario, a stable API version must only depend on stable versions of other APIs.</p>
<p>Different versions of the same API should preferably be able to work at the same time within a single client application for a reasonable transition period. This time period allows the client to transition smoothly to the newer version. An older version must go through a reasonable, well-communicated deprecation period before being shut down.</p>
<p>For releases that have alpha or beta stability, APIs must append the stability level after the major version number in the protobuf package.</p>
<h4 id="release-based-versioning">Release-based versioning</h4>
<p>An individual release is an alpha or beta release that is expected to be available for a limited time period before its functionality is incorporated into the stable channel, after which the individual release will be shut down.
When using release-based versioning strategy, an API may have any number of individual releases at each stability level.</p>
<p>Alpha and beta releases must have their stability level appended to the version, followed by an incrementing release number. For example, v1beta1 or v1alpha5. APIs should document the chronological order of these versions in their documentation (such as comments).
Each alpha or beta release may be updated in place with backwards-compatible changes. For beta releases, backwards-incompatible updates should be made by incrementing the release number and publishing a new release with the change. For example, if the current version is v1beta1, then v1beta2 is released next.</p>
<p>Adapted from <a href="https://cloud.google.com/apis/design/versioning?hl=en#release-based_versioning">google release-based_versioning</a> under Apache 2.0 License &amp; Creative Commons Attribution 4.0 License</p>
<h3 id="backwards-compatibility">Backwards compatibility</h3>
<p>The gRPC protocol is designed to support services that change over time. Generally, additions to gRPC services and methods are non-breaking. Non-breaking changes allow existing clients to continue working without changes. Changing or deleting gRPC services are breaking changes. When gRPC services have breaking changes, clients using that service have to be updated and redeployed.</p>
<p>Making non-breaking changes to a service has a number of benefits:</p>
<ul>
<li>Existing clients continue to run.</li>
<li>Avoids work involved with notifying clients of breaking changes, and updating them.</li>
<li>Only one version of the service needs to be documented and maintained.</li>
</ul>
<h3 id="non-breaking-changes">Non-breaking changes</h3>
<p>These changes are non-breaking at a gRPC protocol level and binary level.</p>
<ul>
<li>Adding a new service</li>
<li>Adding a new method to a service</li>
<li>Adding a field to a request message - Fields added to a request message are deserialized with the default value on the server when not set. To be a non-breaking change, the service must succeed when the new field isn&rsquo;t set by older clients.</li>
<li>Adding a field to a response message - Fields added to a response message are deserialized into the message&rsquo;s unknown fields collection on the client.</li>
<li>Adding a value to an enum - Enums are serialized as a numeric value. New enum values are deserialized on the client to the enum value without an enum name. To be a non-breaking change, older clients must run correctly when receiving the new enum value.</li>
</ul>
<h3 id="binary-breaking-changes">Binary breaking changes</h3>
<p>The following changes are non-breaking at a gRPC protocol level, but the client needs to be updated if it upgrades to the latest .proto contract. Binary compatibility is important if you plan to publish a gRPC library.</p>
<ul>
<li>Removing a field - Values from a removed field are deserialized to a message&rsquo;s unknown fields. This isn&rsquo;t a gRPC protocol breaking change, but the client needs to be updated if it upgrades to the latest contract. It&rsquo;s important that a removed field number isn&rsquo;t accidentally reused in the future. To ensure this doesn&rsquo;t happen, specify deleted field numbers and names on the message using Protobuf&rsquo;s reserved keyword.</li>
<li>Renaming a message - Message names aren&rsquo;t typically sent on the network, so this isn&rsquo;t a gRPC protocol breaking change. The client will need to be updated if it upgrades to the latest contract. One situation where message names are sent on the network is with Any fields, when the message name is used to identify the message type.</li>
<li>Nesting or unnesting a message - Message types can be nested. Nesting or unnesting a message changes its message name. Changing how a message type is nested has the same impact on compatibility as renaming.</li>
</ul>
<h3 id="protocol-breaking-changes">Protocol breaking changes</h3>
<p>The following items are protocol and binary breaking changes:</p>
<ul>
<li>Renaming a field - With Protobuf content, the field names are only used in generated code. The field number is used to identify fields on the network. Renaming a field isn&rsquo;t a protocol breaking change for Protobuf. However, if a server is using JSON content, then renaming a field is a breaking change.</li>
<li>Changing a field data type - Changing a field&rsquo;s data type to an incompatible type will cause errors when deserializing the message. Even if the new data type is compatible, it&rsquo;s likely the client needs to be updated to support the new type if it upgrades to the latest contract.</li>
<li>Changing a field number - With Protobuf payloads, the field number is used to identify fields on the network.</li>
<li>Renaming a package, service or method - gRPC uses the package name, service name, and method name to build the URL. The client gets an UNIMPLEMENTED status from the server.</li>
<li>Removing a service or method - The client gets an UNIMPLEMENTED status from the server when calling the removed method.</li>
</ul>
<h3 id="behavior-breaking-changes">Behavior breaking changes</h3>
<p>When making non-breaking changes, you must also consider whether older clients can continue working with the new service behavior. For example, adding a new field to a request message:</p>
<ul>
<li>Isn&rsquo;t a protocol breaking change.</li>
<li>Returning an error status on the server if the new field isn&rsquo;t set makes it a breaking change for old clients.</li>
</ul>
<p>Behavior compatibility is determined by your app-specific code.</p>
<p>Adapted from <a href="https://docs.microsoft.com/en-us/aspnet/core/grpc/versioning?view=aspnetcore-6.0">Versioning gRPC services</a> under Creative Commons Attribution 4.0 License</p>
<h2 id="error-handling">Error Handling</h2>
<h3 id="grpc-error-handling">gRPC error handling</h3>
<p>In gRPC, a large set of error codes has been <a href="https://grpc.github.io/grpc/cpp/md_doc_statuscodes.html">defined</a>
As a general rule, SDV should use relevant gRPC error codes,
as described in <a href="https://stackoverflow.com/questions/59094839/whats-the-correct-way-to-return-a-not-found-response-from-a-grpc-c-server-i">this thread</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">StatusCode</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">NOT_FOUND</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;error details here&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>Available constructor:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>   <span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span> <span style="color:#000;font-weight:bold">(</span> <span style="color:#000">StatusCode</span>  <span style="color:#000">code</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">string</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">error_message</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">string</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">error_details</span>
</span></span></code></pre></div><p>The framework for drafting error messages could be useful as a later improvement. This could e.g., be used to specify which unit created the error message and to assure the same structure on all messages. The latter two may e.g., depend on debug settings, e.g., error details only in debug-builds to avoid leaks of sensitive information. A global function like below or similar could handle that and also possibly convert between internal error codes and gRPC codes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>   <span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span> <span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CreateStatusMessage</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">PERMISSION_DENIED</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#34;DataBroker&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#34;Rule access rights violated&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="vsc-error-handling">VSC error handling</h3>
<p>VSC recently added errors to the <a href="https://github.com/COVESA/vehicle_service_catalog/blob/master/comfort-service.yml">example service</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>   methods:
</span></span><span style="display:flex;"><span>      - name: move
</span></span><span style="display:flex;"><span>        description: |
</span></span><span style="display:flex;"><span>          Set the desired seat position
</span></span><span style="display:flex;"><span>        in:
</span></span><span style="display:flex;"><span>          - name: seat
</span></span><span style="display:flex;"><span>            description: |
</span></span><span style="display:flex;"><span>              The desired seat position
</span></span><span style="display:flex;"><span>            datatype: seat_t
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        error:
</span></span><span style="display:flex;"><span>          datatype: .stdvsc.error_t
</span></span><span style="display:flex;"><span>          range: $ in_set(&#34;ok&#34;, &#34;completed&#34;, &#34;in_progress&#34;, &#34;interrupted&#34;)
</span></span></code></pre></div><p>The errors come from a <a href="https://github.com/COVESA/vehicle_service_catalog/blob/master/vsc-error.yml">standardized error list</a>,
and for each method in VSC, a range clause can be used to specify which errors from that list that are applicable.</p>
<p>It is in VSC explicitly <a href="https://github.com/COVESA/vehicle_service_catalog#methods-list-object-error">specified</a> that:</p>
<p><em>Transport-layer issues arising from interrupted communication, services going down, etc, are handled on a language-binding level where each language library implements its own way of detecting, reporting, and recovering from network-related errors.</em></p>
<p>This means that VSC error messages intentionally cover a smaller subset than gRPC error messages. Unlike gRPC,
there is currently no detailed documentation in VCS on when individual error codes shall be used, which could cause
problems as some error codes are similar.</p>
<h3 id="sdv-error-handling-for-grpc-interfaces-eg-val-vehicles-services">SDV error handling for gRPC interfaces (e.g., VAL vehicles services)</h3>
<ul>
<li>Use gRPC error codes as base</li>
<li>Document in proto files (as comments) which error codes that the service implementation can emit and the meaning of them. (Errors that only are emitted by the gRPC framework do not need to be listed.)</li>
<li>Do not - unless there are special reasons - add explicit error/status fields to rpc return messages.</li>
<li>Additional error information can be given by free text fields in gRPC error codes. Note, however, that sensitive information like <code>Given password ABCD does not match expected password EFGH</code> should not be passed in an unprotected/unencrypted manner.</li>
</ul>
<h3 id="sdv-handling-of-grpc-error-codes">SDV handling of gRPC error codes</h3>
<p>The table below gives error code guidelines for each gRPC on:</p>
<ul>
<li>If it is relevant for a client to retry the call or not when receiving the error code. Retry is only relevant if the error is of a temporary nature.</li>
<li>Which VSC error code matches the respective gRPC error code</li>
<li>When to use the error code when implementing a service.</li>
</ul>
<table border="1">
  <tbody>
    <tr>
      <th>gRPC error code</th>
      <th>Retry Relevant?</th>
      <th>Corresponding VSC error codes</th>
      <th>Recommended SDV usage</th>
    </tr>
    <tr>
      <td>OK</td>
      <td>No</td>
      <td>ok, completed, in_progress</td>
      <td>Mandatory error code if operation succeeded. Shall never be used if operation failed.</td>
    </tr>
    <tr>
      <td>CANCELLED</td>
      <td>No</td>
      <td>interrupted</td>
      <td>No explicit use case on server side in SDV identified</td>
    </tr>
    <tr>
      <td>UNKNOWN</td>
      <td>No</td>
      <td>other</td>
      <td>To be used in default-statements when converting errors from e.g., Broker-errors to SDV/gRPC errors</td>
    </tr>
    <tr>
      <td>INVALID_ARGUMENT</td>
      <td>No</td>
      <td>invalid_argument</td>
      <td>E.g., Rule syntax with errors</td>
    </tr>
    <tr>
      <td>DEADLINE_EXCEEDED</td>
      <td>Yes</td>
      <td>expired</td>
      <td>Only applicable for asynchronous services, i.e. services which wait for completion before the result is returned. The behavior if a VSC operation cannot finish within expected time must be defined. Two options exist. One is to return this error after e.g., X seconds. Another is that the server never gives up, but rather waits for the client to cancel the operation.</td>
    </tr>
    <tr>
      <td>NOT_FOUND</td>
      <td>No</td>
      <td>not_found</td>
      <td>Long term situation that likely not will change in the near future. <br/> Example: SDV can not find the specified resource (e.g., no path to get data for specified seat) </td>
    </tr>
    <tr>
      <td>ALREADY_EXISTS</td>
      <td>No</td>
      <td>other</td>
      <td>No explicit use case on server side in SDV identified</td>
    </tr>
    <tr>
      <td>PERMISSION_DENIED</td>
      <td>No</td>
      <td>permission_denied</td>
      <td>Operation rejected due to permission denied</td>
    </tr>
    <tr>
      <td>RESOURCE_EXHAUSTED</td>
      <td>Yes</td>
      <td>no_resource, busy</td>
      <td>Possibly if e.g., malloc fails or similar errors.</td>
    </tr>
    <tr>
      <td>FAILED_PRECONDITION</td>
      <td>Yes</td>
      <td>incorrect_state</td>
      <td>Could be returned if e.g., operation is rejected due to safety reasons. (E.g., vehicle moving)</td>
    </tr>
    <tr>
      <td>ABORTED</td>
      <td>Yes</td>
      <td>lost_arbitration</td>
      <td>Could e.g., be returned if service does not support concurrent requests, and there is already either a related operation ongoing or the operation is aborted due to a newer request received. Could also be used if an operation is aborted on user/driver request, e.g., physical button in vehicle pressed.</td>
    </tr>
    <tr>
      <td>OUT_OF_RANGE</td>
      <td>No</td>
      <td>invalid_argument</td>
      <td>E.g., Arguments out of range</td>
    </tr>
    <tr>
      <td>UNIMPLEMENTED</td>
      <td>No</td>
      <td>not_supported</td>
      <td>To be used if certain use-cases of the service are not implemented, e.g., if recline cannot be adjusted</td>
    </tr>
    <tr>
      <td>INTERNAL</td>
      <td>No</td>
      <td>other</td>
      <td>Internal errors, like exceptions, unexpected null pointers and similar</td>
    </tr>
    <tr>
      <td>UNAVAILABLE</td>
      <td>Yes</td>
      <td>no_service</td>
      <td>To be used if the service is temporarily unavailable, e.g., during system startup.</td>
    </tr>
    <tr>
      <td>DATA_LOSS</td>
      <td>No</td>
      <td>other</td>
      <td>No explicit use case identified on server side in SDV. Out of scope of VSC.</td>
    </tr>
    <tr>
      <td>UNAUTHENTICATED</td>
      <td>No</td>
      <td>other</td>
      <td>No explicit use case identified on server side in SDV. Out of scope of VSC.</td>
    </tr>
    <tr>
      <td>N/A</td>
      <td>N/A</td>
      <td>null</td>
      <td>VSC error not applicable if using gRPC as gRPC always return an error code</td>
    </tr>
</table>
<p>As can be seen in the table above, there is not always a 1:1 mapping between VSC errors and gRPC errors.
Parts of this need to be sorted out in VSC context, e.g., difference between <code>ok</code> and <code>completed</code>.</p>
<h3 id="proposed-handling-when-implementing-service-defined-in-vsc">Proposed handling when implementing service defined in VSC</h3>
<p>The starting approach when implementing a service defined in VSC in a framework using gRPC errors is to only use gRPC errors that correspond to defined VSC errors.
If a VSC method e.g., specifies only <code>ok</code> and <code>incorrect_state</code> as error codes,
then an implementation using gRPC shall, if possible, only use the gRPC error codes <code>OK</code> and <code>FAILED_PRECONDITION</code>.
If additional gRPC errors are relevant, then it shall be investigated whether or not the specified VSC list of errors can be extended.</p>
<h3 id="comparison-on-actual-error-code-usage">Comparison on actual error code usage</h3>
<p>The current list of error codes in <a href="https://github.com/COVESA/vehicle_service_catalog/blob/master/comfort-service.yml">VSC</a>
does not cover all error messages that SDV can return. Extensions are needed, but can be covered by
existing VSC error codes.
The existing VSC definitions shall preferably be extended with comments so that the meaning of the different error codes in this particular context are clarified.</p>
<table border="1">
  <tbody>
    <tr>
      <th>VSC Method</th>
      <th>Currently defined VSC errors</th>
      <th>Used gRPC errors</th>
      <th>Proposed VSC changes</th>
    </tr>
    <tr>
      <td>move</td>
      <td>"ok", "completed", "in_progress", "interrupted"</td>
      <td>OK, OUT_OF_RANGE, INVALID_ARGUMENT, INTERNAL</td>
      <td>Add invalid_argument, other. Difference between ok and completed to be clarified. When/how is in_progress to be used? Possibly add "not_found" as used by other methods.</td>
    </tr>
    <tr>
      <td>move_component</td>
      <td>"ok", "not_found", "busy"</td>
      <td>OK, OUT_OF_RANGE, NOT_FOUND, INVALID_ARGUMENT, INTERNAL</td>
      <td>Add invalid_argument, other. </td>
    </tr>
    <tr>
      <td>current_position</td>
      <td>"ok", "not_found"</td>
      <td>OK, OUT_OF_RANGE</td>
      <td>Add invalid_argument, check VSC difference between not_found and invalid_argument </td>
    </tr>
</table>
</br>
<h3 id="other-references">Other references</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/48748745/pattern-for-rich-error-handling-in-grpc">Pattern for rich error handling in gRPC</a></li>
<li><a href="https://jbrandhorst.com/post/grpc-errors/">Advanced gRPC Error Usage</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f1136af6ab1b33398c08627b35700094">3.1.2 - Vehicle Service</h1>
    
	<ul>
<li><a href="#how-to-create-a-vehicle-service">How to create a vehicle service</a>
<ul>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#define-a-service-interface">Define a service interface</a>
<ul>
<li><a href="#semantic-model">Semantic model</a></li>
<li><a href="#interface-technology-and-programming-languages">Interface technology and programming languages</a></li>
<li><a href="#interface-guideline">Interface guideline</a></li>
<li><a href="#error-codes">Error codes</a></li>
</ul>
</li>
<li><a href="#implement-a-vehicle-service">Implement a vehicle service</a>
<ul>
<li><a href="#examples">Examples</a></li>
<li><a href="#responsibility">Responsibility</a></li>
<li><a href="#connection-status">Connection status</a></li>
</ul>
</li>
<li><a href="#add-dapr-support-to-the-vehicle-service">Add Dapr support to the vehicle service</a>
<ul>
<li><a href="#metadata">Metadata</a></li>
<li><a href="#connection-status-with-dapr">Connection status with Dapr</a></li>
</ul>
</li>
<li><a href="#interaction-with-the-vehicle-data-broker-optional">Interaction with the vehicle data broker (optional)</a></li>
</ul>
</li>
</ul>
<h1 id="how-to-create-a-vehicle-service">How to create a vehicle service</h1>
<h2 id="motivation">Motivation</h2>
<p>Vehicle services abstract complex behavior of the vehicle. They abstract the differences in electric and electronic architecture of vehicles from different brands and models to a common interface, which is aligned to a harmonized semantic model. A <em>Vehicle App</em> developer interacts with the vehicle abstraction layer components via the SDK. The SDK and the VAL components are aligned via the interface description, which is derived from the semantic model.</p>
<h2 id="overview">Overview</h2>
<p>Following steps are needed to create a vehicle service:</p>
<ul>
<li>Define a service interface</li>
<li>Implement the service</li>
<li>Add support for <a href="https://dapr.io">Dapr</a> middleware</li>
<li>(optional) Implement simulation</li>
<li>(optional) Interaction with the vehicle data broker</li>
</ul>
<h2 id="define-a-service-interface">Define a service interface</h2>
<h3 id="semantic-model">Semantic model</h3>
<p>The service interface of the vehicle service which abstracts the vehicle behavior, should be aligned to the semantic model. The <a href="https://github.com/COVESA/vehicle_service_catalog">VEHICLE SERVICE CATALOG</a> can be used as the semantic model for a service call.</p>
<h3 id="interface-technology-and-programming-languages">Interface technology and programming languages</h3>
<p>The interface technology used for remote procedure calls is <a href="https://grpc.io/">gGRPC</a>. The methods and datatypes are first defined in a *.proto file, which is then used to generate client and server stubs/skeletons in <a href="https://grpc.io/docs/languages/">different languages</a>.</p>
<p>How to use the interface and generate code can be read e.g., here: <a href="https://grpc.io/docs/languages/cpp/basics/">Basics tutorial for gRPC in C++</a> or <a href="https://grpc.io/docs/languages/python/basics/">Basics tutorial for gRPC in Python</a>.</p>
<h3 id="interface-guideline">Interface guideline</h3>
<p>The <a href="interface_guideline.md">gRPC interface guideline</a> provides you with help on how to specify the service interface.</p>
<h3 id="error-codes">Error codes</h3>
<p>The error codes and recommended usage is described in <a href="/docs/val/interface_guideline/#error-handling">Error Handling</a>. The errors implemented should be described in the gRPC interface description files (*.proto).</p>
<h2 id="implement-a-vehicle-service">Implement a vehicle service</h2>
<h3 id="examples">Examples</h3>
<p>For help on how to implement the vehicle service, see the example seat service or the <a href="https://github.com/grpc/grpc/tree/master/examples">gRPC examples</a> in different languages.</p>
<h3 id="responsibility">Responsibility</h3>
<p>A vehicle service &hellip;</p>
<ul>
<li>Can provide service interfaces to control actuators or to trigger (complex) actions</li>
<li>Can provide service interfaces to get data</li>
<li>Uses service interfaces to register and publish data to the data broker</li>
<li>Reconnects to the data broker in case the connection is lost</li>
<li>Uses the service interface of the data broker via Dapr, if deployed</li>
<li>Communicates with a vehicle network, which is connected to real hardware (e.g., CAN interface)</li>
<li>Communicates with a virtual interface (e.g., CAN interface)</li>
<li>(Optional) Provides a simulation mode to run without a network interface</li>
</ul>
<p>A vehicle service implementation ..</p>
<ul>
<li>might be implemented vehicle- or project-specific</li>
</ul>
<h3 id="connection-status">Connection status</h3>
<p>To be able to detect connectivity problems users of a gRPC service, e.g., for <a href="#interaction-with-the-vehicle-data-broker-optional"> feeding data to the data broker</a>, shall preferably monitor the gRPC connection state, see: <a href="https://grpc.github.io/grpc/core/md_doc_connectivity-semantics-and-api.html">gRPC Connectivity Semantics and API </a>.
This can be used to report or log errors if the connection behaves differently than expected.</p>
<h2 id="add-dapr-support-to-the-vehicle-service">Add Dapr support to the vehicle service</h2>
<p>You can use the gRPC proxying feature of Dapr, which allows you to use custom *.proto files/ interfaces instead of the predefined Dapr gRPC interfaces. More can be read at <a href="https://docs.dapr.io/developing-applications/building-blocks/service-invocation/howto-invoke-services-grpc/">How-To: Invoke services using gRPC</a>.</p>
<p>To support Dapr within your vehicle service application ..</p>
<ul>
<li>the gRPC metadata <code>dapr-app-id</code> of the server needs to be specified in the call</li>
<li>the used gRPC port should be configurable at least via the environment variable, use <code>DAPR_GRPC_PORT</code>.</li>
</ul>
<p>A full reference to the Dapr environment variables can be found <a href="https://docs.dapr.io/reference/environment/">here</a>.</p>
<h3 id="metadata">Metadata</h3>
<p>To call the methods of a gRPC server (e.g. register data points on the data broker) via Dapr the gRPC calls need to be extended with metadata.</p>
<p>We recommend that you read the <code>dapr-app-id</code> of the gRPC server either from the command line parameter, environment variable of configuration file instead of hardcoding it, see for Python:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">grpc_metadata</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;dapr-app-id&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">environ</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;VEHICLEDATABROKER_DAPR_APP_ID&#34;</span><span style="color:#000;font-weight:bold">)),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">channel</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">insecure_channel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">databroker_address</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">channel</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_provider</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">databroker</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Provider</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">channel</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">grpc_metadata</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>This makes it possible to keep the resulting containerized application independent of the configuration and avoid unnecessary rebuilds.</p>
<h3 id="connection-status-with-dapr">Connection status with Dapr</h3>
<p>In a Dapr environment, evaluating the gRPC connectivity state as described in <a href="#connection-status">connection status</a> is not sufficient. Since the vehicle service communicates via gRPC with the Dapr sidecar application instead with the Dapr server directly, the gRPC communication state is also related to the Dapr side car instead of the server. Additional measures need to be taken to check if the &ldquo;real&rdquo; server is available.
Dapr gRPC proxying is only allowed AFTER the Dapr sidecar is fully initialized. If an app port has been specified when running the Dapr sidecar, the sidecar verifies that the service is listening on the port first as part of the initialization.</p>
<p>The following sequence in vehicle services is recommended:</p>
<ol>
<li>Create a gRPC Server and listen</li>
<li>Wait for the sidecar (e.g., poll health endpoint or sleep )</li>
<li>Execute gRPC proxying calls (e.g., against Vehicle Data Broker)</li>
</ol>
<p>Example: A callback for the connectivity state in conjugation with retry to call the server:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">channel</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">insecure_channel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">databroker_address</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">channel</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">connectivity</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">on_broker_connectivity_change</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">connectivity</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">try_to_connect</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">on_broker_connectivity_change</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">connectivity</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">connectivity</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ChannelConnectivity</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">READY</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">connectivity</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ChannelConnectivity</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">IDLE</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">## Can change between READY and IDLE. Only act if coming from</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">## unconnected state</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_connected</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">log</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Connected to data broker&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_register_datapoints</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_registered</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">Exception</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">log</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Failed to register datapoints&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">exc_info</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_connected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_connected</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">log</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Disconnected from data broker&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">else</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">connectivity</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ChannelConnectivity</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">CONNECTING</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">log</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Trying to connect to data broker&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_connected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">_registered</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">False</span>
</span></span></code></pre></div><p>If the Dapr side car is ready to forward, communication can be checked with the <a href="https://grpc.github.io/grpc/core/md_doc_health-checking.html">GRPC Health Checking Protocol </a>, see also <a href="https://grpc.github.io/grpc/python/grpc_health_checking.html">Python gRPC Health Checking</a>.</p>
<h2 id="interaction-with-the-vehicle-data-broker-optional">Interaction with the vehicle data broker (optional)</h2>
<p>Use the <a href="https://github.com/eclipse/kuksa.val/tree/master/kuksa_databroker/proto">interface description of the vehicle data broker (*.proto files)</a> to publish data to the vehicle data broker. In the <code>collector.proto</code> you find methods to</p>
<ol>
<li>register datapoints <code>RegisterDatapoints</code>, afterwards you can</li>
<li>feed data via single calls <code>UpdateDatapoints</code> or in a stream manner <code>StreamDatapoints</code></li>
</ol>
<p>See the *.proto files for a detailed description.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2dbd1b20fb31fad11d756d7570dfb78a">3.2 - Example Use Case</h1>
    
	<p>The example of the seat adjuster provides the option of requesting the new seat position and publishing the current seat position to the customer and demonstrating so the content of the Eclipse project <strong>Velocitas</strong> in this way. The following chapter describes the data flow for the use cases.</p>
<h2 id="requesting-new-seat-position">Requesting new seat position</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/reference/seat_adjuster_use_case/seat_adjuster_dataflow_1_hu3bf97c4e61796e11582c60109bcd27ef_237711_800x0_resize_catmullrom_3.png" width="800" height="477">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Architectural diagram of the seat adjuster example use case
</p>
	</figcaption>
	
</figure>

<ol>
<li>The <strong>Customer</strong> requests the change of the seat position as MQTT message on the topic <code>seatadjuster/setPosition/request</code> with the payload:
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;requestId&#34;</span>: <span style="color:#4e9a06">&#34;xyz&#34;</span>, <span style="color:#4e9a06">&#34;position&#34;</span>: 300<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div></li>
<li>The <strong>Seat Adjuster Vehicle App</strong> that has subscribed to this topic, receives the request to change the seat position as a MQTT message.</li>
<li>The <strong>Seat Adjuster Vehicle App</strong> gets the current vehicle speed from the data broker, which is fed by the <strong>Generic CAN Feeder</strong>.</li>
<li>With the support of the <strong>Vehicle App SDK</strong>, the <strong>Seat Adjuster Vehicle App</strong> triggers a seat adjustment command of the <strong>Seat Service</strong> via gRPC in the event that the speed is equal to zero. Hint: This is a helpful convenience check but not a safety check.</li>
<li>The <strong>Seat Service</strong> moves the seat to the new position via CAN messages.</li>
<li>The <strong>Seat Service</strong> returns OK or an error code as grpc status to the <strong>Seat Adjuster Vehicle App</strong>.</li>
<li>If everything went well, the <strong>Seat Adjuster Vehicle App</strong> returns a success message for the topic <code>seatadjuster/setPosition/response</code> with the payload:
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;requestId&#34;</span>: <span style="color:#4e9a06">&#34;xyz&#34;</span>, <span style="color:#4e9a06">&#34;status&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div>Otherwise, an error message will be returned:
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>requestId<span style="color:#4e9a06">&#34;: &#34;</span>xyz<span style="color:#4e9a06">&#34;, &#34;</span>status<span style="color:#4e9a06">&#34;: 1, &#34;</span>message<span style="color:#4e9a06">&#34; = &#34;</span>&lt;error message&gt;<span style="color:#4e9a06">&#34; }
</span></span></span></code></pre></div></li>
<li>This success or error message will be returned to the <strong>Customer</strong>.</li>
</ol>
<h2 id="publishing-current-seat-position">Publishing current seat position</h2>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 810px">
	<img class="card-img-top" src="/velocitas/docs/reference/seat_adjuster_use_case/seat_adjuster_dataflow_2_hu69015de4a83f48072f5d9f4a269080bf_222663_800x0_resize_catmullrom_3.png" width="800" height="477">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
  Architectural diagram of the data flow for publishing a new seat position
</p>
	</figcaption>
	
</figure>

<ol>
<li>If the seat position will be changed by the driver, the new seat position will be sent to the <strong>Seat Service</strong> via CAN.</li>
<li>The <strong>Seat Service</strong> streams the seat position via gRPC to the <strong>Vehicle Data Broker</strong> since it was registered beforehand.</li>
<li>The <strong>Seat Adjuster Vehicle App</strong> that subscribed to the seat position receives the new seat position from the <strong>Vehicle Data Broker</strong> as a result.</li>
<li>The <strong>Seat Adjuster Vehicle App</strong> publishes this on topic <code>seatadjuster/currentPosition</code> with the payload:
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;position&#34;</span>: 350<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div></li>
<li>The <strong>Customer</strong> who has subscribed to this topic retrieves the new seat position and can store this position to use it for the next trip.</li>
</ol>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8a3bf83ce793563bed50c1b9fb0ecfae">3.3 - Repository Overview</h1>
    
	<p><img src="/assets/project-overview.svg" alt="Overview"></p>
<table>
<thead>
<tr>
<th>Repository</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/eclipse-velocitas/vehicle-app-python-template">vehicle-app-python-template</a></td>
<td>GitHub Template repository containing an exemplary Vehicle App that uses an exemplary SDK to provide access to vehicle data points and methods. The sample SDK extends the <em>sdv-vehicle-app-python-sdk</em>. In addition the template repository contains the development environment for Visual Studio Code for a Vehicle App as well as the CI/CD workflows that can be used as blueprint for your own Vehicle App written in Python.</td>
</tr>
<tr>
<td><a href="https://github.com/eclipse-velocitas/vehicle-app-python-sdk">vehicle-app-python-sdk</a></td>
<td>Provides basis functionality to write an SDK to allow access to vehicle data points and method. This includes publishing &amp; subscribe messaging, talent abstraction, vehicle data model ontology and function-based query &amp; rule support.</td>
</tr>
<tr>
<td><a href="https://github.com/eclipse/kuksa.val">swdc-os-vehicleapi</a></td>
<td>Provides a vehicle abstraction layer (val) including Vehicle Data Broker, an exemplary CAN Data Feeder as well as a Seat Vehicle Service. The Vehicle Data Broker provides data points available in the vehicle to the Vehicle Apps semantically aligned to the <a href="https://covesa.github.io/vehicle_signal_specification/">Vehicle Signal Specification (VSS)</a>. The CAN Data Feeder is an exemplary implementation that reads in data from the vehicle&rsquo;s <a href="https://en.wikipedia.org/wiki/CAN_bus">CAN bus</a>, transforms it according to the VSS and feeds it into the Data Broker. The Seat Vehicle Service is an exemplary implementation that illustrates how to interact with in-vehicle components and services via an unified access that is semantically described in the <a href="https://github.com/COVESA/vehicle_service_catalog">Vehicle Service Catalog (VSC)</a>.</td>
</tr>
<tr>
<td><a href="https://github.com/eclipse-velocitas/release-documentation-action">release-documentation-action</a></td>
<td>GitHub Action to generate a release documentation from the CI workflow output by rendering it to markdown files so that this can be easily published with GitHub Pages.</td>
</tr>
<tr>
<td><a href="https://github.com/eclipse-velocitas/license-check">license-check</a></td>
<td>GitHub Action to collect the licenses of the used components and can be configured to fail with an error message on invalid licenses.</td>
</tr>
<tr>
<td><a href="https://github.com/eclipse-velocitas/vehicle-model-generator">vehicle-model-generator</a></td>
<td>Provides basic functionality to create a vehicle model from the given vspec specification for the target programming language.</td>
</tr>
</tbody>
</table>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8eac61776bcf71227e63036ad316802b">4 - Contribution</h1>
    
	<p>Thanks for thinking about contributing to <strong>Eclipse Velocitas</strong>. We really appreciate the time and effort you want to spend helping to improve Eclipse Velocitas.</p>
<p>However, in order to get you started as fast as possible, we need to go through some organizational issues first.</p>
<h2 id="eclipse-contributor-agreement">Eclipse Contributor Agreement</h2>
<p>Before your contribution can be accepted by the project team, contributors must
electronically sign the Eclipse Contributor Agreement (ECA).</p>
<ul>
<li><a href="http://www.eclipse.org/legal/ECA.php">http://www.eclipse.org/legal/ECA.php</a></li>
</ul>
<p>Commits that are provided by non-committers must have a Signed-off-by field in
the footer indicating that the author is aware of the terms by which the
contribution has been provided to the project. The non-committer must
additionally have an Eclipse Foundation account and must have a signed Eclipse
Contributor Agreement (ECA) on file.</p>
<p>For more information, please see the Eclipse Committer Handbook:
<a href="https://www.eclipse.org/projects/handbook/#resources-commit">https://www.eclipse.org/projects/handbook/#resources-commit</a></p>
<h2 id="making-your-changes">Making Your Changes</h2>
<ul>
<li>Fork the repository on GitHub.</li>
<li>Create a new branch for your changes.</li>
<li>Make your changes following the code style guide (see Code Style Guide section above).</li>
<li>When you create new files, make sure you include a proper license header at the top of the file (see License Header section below).</li>
<li>Make sure you include test cases for non-trivial features.</li>
<li>Make sure test cases provide sufficient code coverage (see GitHub actions for minimal accepted coverage).</li>
<li>Make sure the test suite passes after your changes.</li>
<li>Commit your changes into that branch.</li>
<li>Use descriptive and meaningful commit messages. Start the first line of the commit message with the issue number and title e.g., <code>[#9865] Add token-based authentication</code>.</li>
<li>Squash multiple commits that are related to each other semantically into a single one.</li>
<li>Make sure you use the <code>-s</code> flag when committing as explained above.</li>
<li>Push your changes to your branch in your forked repository.</li>
</ul>
<h2 id="adding-documentation-to-hugo">Adding Documentation to Hugo</h2>
<ul>
<li>Add the markdown document to the appropriate folder in the path velocitas-docs/hugo/hugo/content.</li>
<li>Add the front-matter</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000">---</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;title of the file&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">date</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">2022-05-09T13:43:25</span><span style="color:#0000cf;font-weight:bold">+05</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">---</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ul>
<li>Additional front matter that can be added –
<ul>
<li>url : &quot;specifying a definite url to the file&quot;</li>
<li>weight : 10 (used for ordering your content in lists. Lower weight gets higher precedence.)</li>
</ul>
</li>
<li>The images need to be put in path velocitas-docs/hugo/hugo/static/assests. The image reference should be /assests/image.jpg in the markdown file.
(Note: Do not use relative paths or url)</li>
<li>In case you are creating a new folder, create _index.md file with the front matter only.</li>
</ul>
<h2 id="running-locally">Running Locally</h2>
<ul>
<li>Install hugo version 0.98.0 extended <a href="https://github.com/gohugoio/hugo/releases/tag/v0.98.0">Release v0.98.0 · gohugoio/hugo (github.com)</a></li>
<li>Install Docsy theme in the path velocitas-docs/hugo/hugo/theme –</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#Run this command from the root directory of velocitas-docs</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/google/docsy.git hugo/hugo/themes/docsy
</span></span></code></pre></div><ul>
<li>Install pre-requisites</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> themes/docsy/userguide/
</span></span><span style="display:flex;"><span>npm install
</span></span><span style="display:flex;"><span>npm install --save-dev postcss
</span></span></code></pre></div><ul>
<li>Run the command <strong>hugo server</strong> visit localhost:1313 from the velocitas-docs/hugo/hugo directory to see the rendered static site.</li>
</ul>
<h2 id="submitting-the-changes">Submitting the Changes</h2>
<p>Submit a pull request via the normal GitHub UI.</p>
<h2 id="after-submitting">After Submitting</h2>
<ul>
<li>Do not use your branch for any other development, otherwise further changes that you make will be visible in the PR.</li>
</ul>
<h2 id="license-header">License Header</h2>
<p>Please make sure any file you newly create contains a proper license header like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Copyright (c) &lt;year&gt; Contributors to the Eclipse Foundation</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># See the NOTICE file(s) distributed with this work for additional</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># information regarding copyright ownership.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># This program and the accompanying materials are made available under the</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># terms of the Apache License 2.0 which is available at</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># http://www.apache.org/licenses/LICENSE-2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># SPDX-License-Identifier: Apache-2.0</span>
</span></span></code></pre></div><p>You should, of course, adapt this header to use the specific mechanism for comments pertaining to the type of file you create.</p>
<p><strong>Important</strong></p>
<p>Please do not forget to add your name/organization to the <code>/legal/legal/NOTICE.md</code> file&rsquo;s <em>Copyright Holders</em> section. If this is not the first contribution you make, then simply update the time period contained in the copyright entry to use the year of your first contribution as the lower boundary and the current year as the upper boundary, e.g.,</p>
<p><code>Copyright 2017, 2018 ACME Corporation</code></p>
<h2 id="build">Build</h2>
<ul>
<li>A pipeline run will be triggered on every PR merge. This run will trigger the hugo docs build</li>
<li>Hugo v0.98.0 extended is set up for the runner</li>
<li>Docsy theme is setup for beautification of static site</li>
<li>Then dependencies are installed for the theme</li>
<li>Static site is generated and stored in a folder &quot;public&quot;</li>
<li>The contents of public are committed to gh_pages branch which is exposed to host the GitHub pages</li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Eclipse Velocitas Project" aria-label="Eclipse Velocitas Project">
    <a class="text-white" target="_blank" rel="noopener" href="https://projects.eclipse.org/projects/automotive.velocitas" aria-label="Eclipse Velocitas Project">
      <i class="fas fa-external-link-alt"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/eclipse-velocitas" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Developer mailing list" aria-label="Developer mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://accounts.eclipse.org/mailing-list/velocitas-dev" aria-label="Developer mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 The Eclipse Velocity™ Project. All Rights Reserved.</small>
        
        
      </div>
    </div>
    <div class="row">
      <div class="col-12 text-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2">
    <small class="ml-1">
      <a class="text-footer-menu" target="_blank" rel="noopener" href="https://eclipse.org">
        Eclipse Foundation
      </a>
    </small>
  </li>
  
  <li class="list-inline-item mx-2">
    <small class="ml-1">
      <a class="text-footer-menu" target="_blank" rel="noopener" href="https://eclipse.org/legal/privacy.php">
        Privacy Policy
      </a>
    </small>
  </li>
  
  <li class="list-inline-item mx-2">
    <small class="ml-1">
      <a class="text-footer-menu" target="_blank" rel="noopener" href="https://eclipse.org/legal/termsofuse.php">
        Terms of Use
      </a>
    </small>
  </li>
  
  <li class="list-inline-item mx-2">
    <small class="ml-1">
      <a class="text-footer-menu" target="_blank" rel="noopener" href="https://eclipse.org/legal/copyright.php">
        Copyright Agent
      </a>
    </small>
  </li>
  
  <li class="list-inline-item mx-2">
    <small class="ml-1">
      <a class="text-footer-menu" target="_blank" rel="noopener" href="https://eclipse.org/legal/">
        Legal
      </a>
    </small>
  </li>
  
  <li class="list-inline-item mx-2">
    <small class="ml-1">
      <a class="text-footer-menu" target="_blank" rel="noopener" href="https://eclipse.org/legal/epl-2.0/">
        License
      </a>
    </small>
  </li>
  
  <li class="list-inline-item mx-2">
    <small class="ml-1">
      <a class="text-footer-menu" target="_blank" rel="noopener" href="https://eclipse.org/security/">
        Report a Vulnerability
      </a>
    </small>
  </li>
  
</ul>

        
        
      </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/velocitas/js/tabpane-persist.js'></script>




















<script src="/velocitas/js/main.min.0a4011cc64eece3f188017a6ab918e3311f9db86caa7b500616261bc807bbedb.js" integrity="sha256-CkARzGTuzj8YgBemq5GOMxH524bKp7UAYWJhvIB7vts=" crossorigin="anonymous"></script>




  </body>
</html>
